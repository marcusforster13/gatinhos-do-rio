<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gatinhos do Rio üê±</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Baloo+2:wght@400;600;800&family=Fredoka+One&display=swap" rel="stylesheet">
<style>
  :root {
    --verde: #1a7a4a;
    --amarelo: #f5c518;
    --azul: #1e4fa8;
    --laranja: #e8621a;
    --creme: #fdf6e3;
    --marrom: #5c3d1e;
    --rosa: #e84393;
    --tile-bg: #e8f4fd;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Baloo 2', cursive;
    background: var(--creme);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* TAB NAV */
  .tab-nav {
    display: flex;
    background: rgba(0,0,0,0.2);
    border-top: 1px solid rgba(255,255,255,0.1);
  }

  .tab-btn {
    flex: 1;
    padding: 10px;
    background: none;
    border: none;
    color: rgba(255,255,255,0.55);
    font-family: 'Fredoka One', cursive;
    font-size: 1rem;
    cursor: pointer;
    letter-spacing: 0.5px;
    border-bottom: 3px solid transparent;
    transition: all 0.2s;
  }

  .tab-btn:hover { color: rgba(255,255,255,0.85); }
  .tab-btn.active {
    color: var(--amarelo);
    border-bottom-color: var(--amarelo);
    background: rgba(255,255,255,0.06);
  }

  /* GAME SECTION */
  #gameSection {
    display: none;
  }

  .game-wrapper {
    max-width: 900px;
    margin: 0 auto;
    padding: 20px 16px;
  }

  .game-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 14px;
    flex-wrap: wrap;
    gap: 10px;
  }

  .game-title {
    font-family: 'Fredoka One', cursive;
    font-size: 1.4rem;
    color: var(--azul);
  }

  .game-stats {
    display: flex;
    gap: 16px;
    align-items: center;
  }

  .game-stat {
    background: white;
    border-radius: 30px;
    padding: 6px 16px;
    font-family: 'Fredoka One', cursive;
    font-size: 1rem;
    color: var(--marrom);
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .game-stat span { color: var(--verde); }

  .game-canvas-wrap {
    position: relative;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0,0,0,0.25);
    cursor: pointer;
    user-select: none;
  }

  #gameCanvas {
    display: block;
    width: 100%;
    height: auto;
  }

  .game-overlay {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.55);
    backdrop-filter: blur(4px);
    transition: opacity 0.3s;
  }

  .game-overlay.hidden { opacity: 0; pointer-events: none; }

  .game-overlay-title {
    font-family: 'Fredoka One', cursive;
    font-size: clamp(1.6rem, 5vw, 2.8rem);
    color: var(--amarelo);
    text-shadow: 2px 4px 0 rgba(0,0,0,0.4);
    margin-bottom: 8px;
    text-align: center;
  }

  .game-overlay-sub {
    color: rgba(255,255,255,0.8);
    font-size: clamp(0.85rem, 2.5vw, 1.05rem);
    margin-bottom: 24px;
    text-align: center;
    padding: 0 16px;
  }

  .game-start-btn {
    background: linear-gradient(135deg, var(--verde), #0f5c35);
    color: white;
    border: none;
    padding: 14px 40px;
    font-family: 'Fredoka One', cursive;
    font-size: clamp(1rem, 3vw, 1.3rem);
    border-radius: 50px;
    cursor: pointer;
    box-shadow: 0 4px 0 #093d22, 0 0 20px rgba(26,122,74,0.4);
    transition: all 0.2s;
  }

  .game-start-btn:hover { transform: translateY(-2px); }

  .game-instructions {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-top: 18px;
    flex-wrap: wrap;
  }

  .game-key {
    display: flex;
    align-items: center;
    gap: 6px;
    color: rgba(255,255,255,0.7);
    font-size: 0.85rem;
  }

  .key-badge {
    background: rgba(255,255,255,0.15);
    border: 1px solid rgba(255,255,255,0.3);
    border-radius: 6px;
    padding: 2px 10px;
    font-family: 'Fredoka One', cursive;
    font-size: 0.8rem;
  }

  .game-score-board {
    background: white;
    border-radius: 16px;
    padding: 16px 20px;
    margin-top: 16px;
    display: flex;
    justify-content: space-around;
    align-items: center;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  }

  .score-item {
    text-align: center;
  }

  .score-item-label {
    font-size: 0.72rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: #aaa;
    font-weight: 700;
  }

  .score-item-value {
    font-family: 'Fredoka One', cursive;
    font-size: 1.5rem;
    color: var(--marrom);
  }

  .score-item-value.gold { color: var(--amarelo); }
  .score-item-value.green { color: var(--verde); }

  /* TILE PATTERN */
  .tile-pattern {
    background-color: var(--azul);
    background-image:
      radial-gradient(circle at 25% 25%, rgba(255,255,255,0.15) 0%, transparent 50%),
      repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255,255,255,0.05) 10px, rgba(255,255,255,0.05) 20px);
  }

  /* HEADER */
  header {
    background: var(--verde);
    padding: 0;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
  }

  .header-azulejo {
    height: 8px;
    background: repeating-linear-gradient(90deg, var(--azul) 0px, var(--azul) 20px, var(--amarelo) 20px, var(--amarelo) 40px, var(--verde) 40px, var(--verde) 60px, var(--laranja) 60px, var(--laranja) 80px);
  }

  .header-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 32px;
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .logo-icon {
    font-size: 2.5rem;
    animation: wiggle 2s ease-in-out infinite;
  }

  @keyframes wiggle {
    0%, 100% { transform: rotate(-5deg); }
    50% { transform: rotate(5deg); }
  }

  .logo-text h1 {
    font-family: 'Fredoka One', cursive;
    font-size: 1.8rem;
    color: var(--amarelo);
    text-shadow: 2px 2px 0 rgba(0,0,0,0.3);
    line-height: 1;
  }

  .logo-text p {
    color: rgba(255,255,255,0.8);
    font-size: 0.75rem;
    letter-spacing: 1px;
    text-transform: uppercase;
  }

  .cart-btn {
    background: var(--amarelo);
    border: none;
    border-radius: 50px;
    padding: 10px 24px;
    font-family: 'Fredoka One', cursive;
    font-size: 1.1rem;
    color: var(--marrom);
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s;
    box-shadow: 0 4px 0 rgba(0,0,0,0.2);
  }

  .cart-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 0 rgba(0,0,0,0.2);
  }

  .cart-count {
    background: var(--laranja);
    color: white;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 0.85rem;
    font-weight: 900;
    transition: transform 0.3s;
  }

  .cart-count.bounce {
    animation: cartBounce 0.4s ease;
  }

  @keyframes cartBounce {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.5); }
  }

  /* HERO */
  .hero {
    background: linear-gradient(135deg, var(--azul) 0%, #0d2d6b 100%);
    padding: 40px 32px;
    text-align: center;
    position: relative;
    overflow: hidden;
  }

  .hero::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image: 
      radial-gradient(circle at 20% 50%, rgba(245,197,24,0.15) 0%, transparent 50%),
      radial-gradient(circle at 80% 20%, rgba(232,98,26,0.2) 0%, transparent 40%);
  }

  .hero-tiles {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 6px;
    background: repeating-linear-gradient(90deg, var(--amarelo) 0px, var(--amarelo) 30px, var(--laranja) 30px, var(--laranja) 60px, var(--rosa) 60px, var(--rosa) 90px, var(--verde) 90px, var(--verde) 120px);
  }

  .hero h2 {
    font-family: 'Playfair Display', serif;
    font-size: clamp(1.8rem, 4vw, 3rem);
    color: white;
    position: relative;
    text-shadow: 2px 4px 8px rgba(0,0,0,0.4);
  }

  .hero h2 span {
    color: var(--amarelo);
  }

  .hero p {
    color: rgba(255,255,255,0.85);
    margin-top: 10px;
    font-size: 1.05rem;
    position: relative;
  }

  .steps-bar {
    display: flex;
    justify-content: center;
    gap: 0;
    margin-top: 24px;
    position: relative;
  }

  .step {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    padding: 0 24px;
    position: relative;
  }

  .step:not(:last-child)::after {
    content: '‚Üí';
    position: absolute;
    right: -6px;
    top: 14px;
    color: var(--amarelo);
    font-size: 1.2rem;
  }

  .step-num {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: var(--amarelo);
    color: var(--marrom);
    font-family: 'Fredoka One', cursive;
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  }

  .step-label {
    font-size: 0.7rem;
    color: rgba(255,255,255,0.8);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    white-space: nowrap;
  }

  /* MAIN */
  main {
    max-width: 1200px;
    margin: 0 auto;
    padding: 32px 16px;
  }

  /* SHELTER SELECTOR */
  .section-title {
    font-family: 'Playfair Display', serif;
    font-size: 1.6rem;
    color: var(--marrom);
    margin-bottom: 6px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .section-subtitle {
    color: #888;
    font-size: 0.9rem;
    margin-bottom: 20px;
  }

  .shelters-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 16px;
    margin-bottom: 48px;
  }

  .shelter-card {
    background: white;
    border-radius: 16px;
    padding: 18px;
    border: 3px solid transparent;
    cursor: pointer;
    transition: all 0.25s;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    position: relative;
    overflow: hidden;
  }

  .shelter-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 5px;
    background: linear-gradient(90deg, var(--azul), var(--verde));
  }

  .shelter-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 24px rgba(0,0,0,0.15);
  }

  .shelter-card.selected {
    border-color: var(--verde);
    background: #f0fbf4;
  }

  .shelter-card.selected::after {
    content: '‚úì';
    position: absolute;
    top: 10px;
    right: 10px;
    width: 28px;
    height: 28px;
    background: var(--verde);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 900;
    font-size: 0.9rem;
  }

  .shelter-emoji { font-size: 2.2rem; margin-bottom: 8px; }
  .shelter-name { font-weight: 800; font-size: 1rem; color: var(--marrom); }
  .shelter-neighborhood { font-size: 0.8rem; color: #888; margin-top: 2px; }
  .shelter-cats { 
    margin-top: 8px;
    font-size: 0.78rem;
    color: var(--azul);
    background: #e8f0fe;
    padding: 4px 10px;
    border-radius: 20px;
    display: inline-block;
    font-weight: 600;
  }

  /* STORE / SHELVES */
  .store-container {
    background: linear-gradient(180deg, #8B4513 0%, #6B3410 100%);
    border-radius: 20px;
    padding: 24px;
    margin-bottom: 48px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    position: relative;
    overflow: hidden;
  }

  .store-container::before {
    content: 'üè¨ Armaz√©m dos Gatinhos';
    font-family: 'Fredoka One', cursive;
    font-size: 1.4rem;
    color: var(--amarelo);
    display: block;
    text-align: center;
    margin-bottom: 16px;
    text-shadow: 1px 2px 4px rgba(0,0,0,0.5);
  }

  .store-bg {
    background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='60' height='60'%3E%3Crect width='60' height='60' fill='%23f5f0e8'/%3E%3Crect x='0' y='0' width='30' height='30' fill='%23ece5d5'/%3E%3Crect x='30' y='30' width='30' height='30' fill='%23ece5d5'/%3E%3C/svg%3E");
    border-radius: 12px;
    padding: 24px;
  }

  .shelf {
    background: linear-gradient(180deg, #c8a46e 0%, #a0724a 100%);
    border-radius: 4px;
    padding: 16px 16px 8px;
    margin-bottom: 28px;
    position: relative;
    box-shadow: 0 6px 0 #6b3410, 0 8px 0 rgba(0,0,0,0.2);
  }

  .shelf::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 8px;
    background: linear-gradient(180deg, #d4b07e, #c8a46e);
    border-radius: 4px 4px 0 0;
  }

  .shelf-label {
    font-family: 'Fredoka One', cursive;
    color: white;
    font-size: 0.95rem;
    margin-bottom: 14px;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
    padding-left: 4px;
  }

  .shelf-items {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
  }

  .item-card {
    background: white;
    border-radius: 14px;
    padding: 14px;
    width: 140px;
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
    border: 3px solid transparent;
    position: relative;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }

  .item-card:hover {
    transform: translateY(-6px) rotate(-2deg);
    box-shadow: 0 12px 20px rgba(0,0,0,0.2);
  }

  .item-card.in-cart {
    border-color: var(--verde);
    background: #f0fbf4;
  }

  .item-card.in-cart::after {
    content: '‚úì';
    position: absolute;
    top: -8px;
    right: -8px;
    width: 24px;
    height: 24px;
    background: var(--verde);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    font-weight: 900;
  }

  .item-emoji {
    font-size: 2.8rem;
    display: block;
    margin-bottom: 6px;
    transition: transform 0.2s;
  }

  .item-card:hover .item-emoji {
    transform: scale(1.15);
  }

  .item-name {
    font-size: 0.78rem;
    font-weight: 700;
    color: var(--marrom);
    line-height: 1.2;
  }

  .item-price {
    font-family: 'Fredoka One', cursive;
    font-size: 0.95rem;
    color: var(--verde);
    margin-top: 4px;
  }

  .item-qty {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    margin-top: 8px;
  }

  .qty-btn {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    border: 2px solid var(--azul);
    background: white;
    color: var(--azul);
    font-weight: 900;
    font-size: 1rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
    transition: all 0.15s;
  }

  .qty-btn:hover {
    background: var(--azul);
    color: white;
  }

  .qty-num {
    font-family: 'Fredoka One', cursive;
    font-size: 1rem;
    color: var(--marrom);
    min-width: 20px;
    text-align: center;
  }

  .add-sticker {
    position: absolute;
    top: -6px;
    left: -6px;
    background: var(--laranja);
    color: white;
    font-size: 0.6rem;
    font-weight: 800;
    padding: 2px 6px;
    border-radius: 20px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    pointer-events: none;
  }

  /* CART SUMMARY */
  .cart-panel {
    background: white;
    border-radius: 20px;
    padding: 24px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.12);
    margin-bottom: 32px;
    border: 2px solid #eee;
  }

  .cart-empty {
    text-align: center;
    padding: 32px;
    color: #aaa;
    font-size: 1rem;
  }

  .cart-empty span {
    font-size: 3rem;
    display: block;
    margin-bottom: 8px;
  }

  .cart-items-list { list-style: none; }

  .cart-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 0;
    border-bottom: 1px dashed #eee;
    animation: slideIn 0.3s ease;
  }

  @keyframes slideIn {
    from { opacity: 0; transform: translateX(-20px); }
    to { opacity: 1; transform: translateX(0); }
  }

  .cart-item-emoji { font-size: 1.8rem; }
  .cart-item-info { flex: 1; }
  .cart-item-name { font-weight: 700; font-size: 0.9rem; color: var(--marrom); }
  .cart-item-sub { font-size: 0.78rem; color: #888; }
  .cart-item-price { font-family: 'Fredoka One', cursive; color: var(--verde); font-size: 1rem; }

  .remove-btn {
    background: none;
    border: none;
    color: #ccc;
    font-size: 1.2rem;
    cursor: pointer;
    transition: color 0.2s;
    padding: 4px;
  }

  .remove-btn:hover { color: var(--laranja); }

  .cart-total {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 16px;
    padding-top: 16px;
    border-top: 2px solid var(--amarelo);
  }

  .cart-total-label {
    font-family: 'Playfair Display', serif;
    font-size: 1.2rem;
    color: var(--marrom);
  }

  .cart-total-price {
    font-family: 'Fredoka One', cursive;
    font-size: 1.8rem;
    color: var(--verde);
  }

  /* CTA BUTTON */
  .cta-section {
    text-align: center;
    margin-bottom: 48px;
  }

  .donate-btn {
    background: linear-gradient(135deg, var(--verde), #0f5c35);
    color: white;
    border: none;
    padding: 18px 52px;
    font-family: 'Fredoka One', cursive;
    font-size: 1.5rem;
    border-radius: 60px;
    cursor: pointer;
    box-shadow: 0 6px 0 #093d22, 0 8px 20px rgba(0,0,0,0.3);
    transition: all 0.2s;
    display: inline-flex;
    align-items: center;
    gap: 12px;
    position: relative;
    overflow: hidden;
  }

  .donate-btn::before {
    content: '';
    position: absolute;
    top: 0; left: -100%;
    width: 60%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    animation: shine 3s infinite;
  }

  @keyframes shine {
    to { left: 200%; }
  }

  .donate-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 9px 0 #093d22, 0 12px 24px rgba(0,0,0,0.3);
  }

  .donate-btn:active {
    transform: translateY(3px);
    box-shadow: 0 3px 0 #093d22;
  }

  .donate-btn:disabled {
    background: #ccc;
    box-shadow: 0 4px 0 #aaa;
    cursor: not-allowed;
    transform: none;
  }

  .warning-msg {
    margin-top: 12px;
    color: var(--laranja);
    font-size: 0.88rem;
    font-weight: 600;
  }


  /* MODAL OVERLAY */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.88);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.4s;
  }

  .modal-overlay.active {
    opacity: 1;
    pointer-events: all;
  }

  /* LOOT BOX MODAL */
  .lootbox-modal {
    background: #0f0c29;
    border-radius: 28px;
    padding: 32px 28px;
    max-width: 460px;
    width: 93%;
    text-align: center;
    position: relative;
    transform: scale(0.6) translateY(60px);
    transition: transform 0.55s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    overflow: hidden;
    border: 2px solid rgba(255,255,255,0.08);
    box-shadow: 0 0 80px rgba(245,197,24,0.12), 0 0 0 1px rgba(255,255,255,0.05);
    max-height: 95vh;
    overflow-y: auto;
  }

  .modal-overlay.active .lootbox-modal {
    transform: scale(1) translateY(0);
  }

  .lootbox-modal::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(ellipse at 50% -20%, rgba(245,197,24,0.1) 0%, transparent 60%),
                radial-gradient(ellipse at 20% 110%, rgba(232,98,26,0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 110%, rgba(30,79,168,0.12) 0%, transparent 50%);
    pointer-events: none;
  }

  .confetti-container {
    position: absolute;
    inset: 0;
    pointer-events: none;
    overflow: hidden;
    z-index: 0;
  }

  .confetti-piece {
    position: absolute;
    top: -10px;
    animation: confettiFall linear both;
  }

  @keyframes confettiFall {
    to { transform: translateY(600px) rotate(720deg); opacity: 0; }
  }

  /* PHASE 1: TAP THE BOX */
  #lootPhase1 { padding: 4px 0 12px; }

  .loot-phase-title {
    font-family: 'Fredoka One', cursive;
    font-size: 0.78rem;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: rgba(255,255,255,0.35);
    margin-bottom: 16px;
  }

  .box-stage {
    position: relative;
    height: 190px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 12px;
  }

  .loot-glow-ring {
    position: absolute;
    width: 150px; height: 150px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(245,197,24,0.18) 0%, transparent 70%);
    animation: glowPulse 1.2s ease-in-out infinite;
    pointer-events: none;
    z-index: 0;
  }

  @keyframes glowPulse {
    0%, 100% { transform: scale(0.9); opacity: 0.5; }
    50% { transform: scale(1.25); opacity: 1; }
  }

  .loot-box-emoji {
    font-size: 5.5rem;
    position: relative;
    cursor: pointer;
    user-select: none;
    filter: drop-shadow(0 0 18px rgba(245,197,24,0.55));
    z-index: 2;
  }

  .loot-box-emoji.shaking {
    animation: boxShake 0.4s ease-in-out;
  }

  @keyframes boxShake {
    0%,100% { transform: rotate(0deg) scale(1); }
    20%     { transform: rotate(-10deg) scale(1.08); }
    40%     { transform: rotate(10deg) scale(1.1); }
    60%     { transform: rotate(-7deg) scale(1.08); }
    80%     { transform: rotate(7deg) scale(1.06); }
  }

  .loot-particles {
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 1;
  }

  .loot-particle {
    position: absolute;
    top: 50%; left: 50%;
    font-size: 1.4rem;
    animation: particleBurst 0.7s linear both;
    opacity: 0;
  }

  @keyframes particleBurst {
    0% { transform: translate(-50%,-50%) scale(0); opacity: 1; }
    60% { opacity: 1; }
    100% { transform: translate(var(--tx), var(--ty)) scale(0.4); opacity: 0; }
  }

  .tap-hint {
    color: rgba(255,255,255,0.45);
    font-size: 0.85rem;
    animation: blink 1.4s ease-in-out infinite;
    margin-bottom: 12px;
  }

  @keyframes blink {
    0%,100% { opacity: 1; }
    50% { opacity: 0.2; }
  }

  .loot-taps-bar {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 4px;
  }

  .tap-dot {
    width: 14px; height: 14px;
    border-radius: 50%;
    background: rgba(255,255,255,0.1);
    border: 2px solid rgba(255,255,255,0.2);
    transition: all 0.25s;
  }

  .tap-dot.filled {
    background: var(--amarelo);
    border-color: var(--amarelo);
    box-shadow: 0 0 10px rgba(245,197,24,0.7);
    transform: scale(1.25);
  }

  /* PHASE 2: EXPLOSION */
  #lootPhase2 { display: none; }

  .open-explosion {
    height: 210px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
    gap: 12px;
  }

  .open-box-emoji {
    font-size: 5rem;
    animation: boxExplode 0.7s ease-out both;
    filter: drop-shadow(0 0 32px rgba(245,197,24,0.9));
  }

  @keyframes boxExplode {
    0% { transform: scale(1); }
    25% { transform: scale(1.5) rotate(-6deg); }
    50% { transform: scale(0.8) rotate(4deg); }
    75% { transform: scale(1.25) rotate(-2deg); }
    100% { transform: scale(1) rotate(0); }
  }

  .rays {
    position: absolute;
    top: 30%; left: 50%;
    transform: translate(-50%, -50%);
    width: 160px; height: 160px;
  }

  .ray {
    position: absolute;
    width: 3px;
    height: 70px;
    background: linear-gradient(to top, transparent, var(--amarelo));
    transform-origin: bottom center;
    border-radius: 3px;
    animation: rayShoot 0.9s ease-out both;
    opacity: 0;
    left: 50%; bottom: 50%;
  }

  @keyframes rayShoot {
    0% { transform: rotate(var(--angle)) scaleY(0); opacity: 0; }
    30% { opacity: 1; }
    60% { transform: rotate(var(--angle)) scaleY(1); opacity: 0.8; }
    100% { transform: rotate(var(--angle)) scaleY(0) translateY(-20px); opacity: 0; }
  }

  .open-text {
    font-family: 'Fredoka One', cursive;
    font-size: 1.6rem;
    color: var(--amarelo);
    animation: openTextAppear 0.5s 0.3s both;
    text-shadow: 0 0 24px rgba(245,197,24,0.6);
    position: relative;
  }

  @keyframes openTextAppear {
    from { opacity: 0; transform: scale(0.4) rotate(-10deg); }
    to { opacity: 1; transform: scale(1) rotate(0); }
  }

  /* PHASE 3: SLOT ROLLING */
  #lootPhase3 { display: none; }

  .slot-title {
    font-family: 'Fredoka One', cursive;
    font-size: 0.9rem;
    color: rgba(255,255,255,0.5);
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 16px;
  }

  .slot-machine {
    background: rgba(0,0,0,0.45);
    border-radius: 18px;
    border: 2px solid rgba(255,255,255,0.1);
    padding: 0 16px;
    margin-bottom: 14px;
    position: relative;
    overflow: hidden;
    height: 88px;
  }

  .slot-machine::before, .slot-machine::after {
    content: '';
    position: absolute;
    left: 0; right: 0;
    height: 28px;
    z-index: 2;
    pointer-events: none;
  }

  .slot-machine::before {
    top: 0;
    background: linear-gradient(to bottom, rgba(15,12,41,0.9), transparent);
  }

  .slot-machine::after {
    bottom: 0;
    background: linear-gradient(to top, rgba(15,12,41,0.9), transparent);
  }

  .slot-highlight {
    position: absolute;
    left: 0; right: 0;
    top: 50%; transform: translateY(-50%);
    height: 80px;
    border-top: 2px solid rgba(245,197,24,0.5);
    border-bottom: 2px solid rgba(245,197,24,0.5);
    background: rgba(245,197,24,0.05);
    z-index: 1;
    pointer-events: none;
  }

  .slot-reel {
    height: 88px;
    overflow: hidden;
    position: relative;
    z-index: 0;
  }

  .slot-items {
    display: flex;
    flex-direction: column;
    align-items: center;
    will-change: transform;
  }

  .slot-item {
    height: 88px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    width: 100%;
    gap: 2px;
  }

  .slot-item-emoji { font-size: 2.5rem; line-height: 1; }
  .slot-item-name {
    font-family: 'Fredoka One', cursive;
    font-size: 0.78rem;
    color: rgba(255,255,255,0.55);
  }

  /* PHASE 4: REVEAL */
  #lootPhase4 { display: none; }

  .prize-rarity-badge {
    display: inline-block;
    padding: 5px 20px;
    border-radius: 30px;
    font-family: 'Fredoka One', cursive;
    font-size: 0.82rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 12px;
    animation: badgeAppear 0.5s 0.2s both;
  }

  @keyframes badgeAppear {
    from { transform: scale(0) rotate(-12deg); opacity: 0; }
    to { transform: scale(1) rotate(0); opacity: 1; }
  }

  .rarity-comum { background: linear-gradient(90deg,#555,#888); color: white; box-shadow: 0 0 10px rgba(150,150,150,0.3); }
  .rarity-raro { background: linear-gradient(90deg, #1e4fa8, #4a90d9); color: white; box-shadow: 0 0 16px rgba(74,144,217,0.5); }
  .rarity-epico { background: linear-gradient(90deg, #7b2ff7, #c84bff); color: white; box-shadow: 0 0 22px rgba(200,75,255,0.65); }
  .rarity-lendario {
    background: linear-gradient(90deg, #e8621a, #f5c518, #e8621a);
    background-size: 200%;
    color: #2a1500;
    font-weight: 900;
    animation: badgeAppear 0.5s 0.2s both, legendShimmer 2s 0.8s linear infinite, legendaryGlow 1.5s 0.8s ease-in-out infinite alternate;
  }

  @keyframes legendShimmer {
    0% { background-position: 0%; }
    100% { background-position: 200%; }
  }

  @keyframes legendaryGlow {
    from { box-shadow: 0 0 20px rgba(245,197,24,0.6); }
    to { box-shadow: 0 0 44px rgba(245,197,24,1), 0 0 88px rgba(232,98,26,0.5); }
  }

  .prize-big-emoji {
    font-size: 5.5rem;
    display: block;
    animation: prizeReveal 0.75s 0.4s both;
    filter: drop-shadow(0 0 22px rgba(245,197,24,0.5));
    margin: 4px 0;
  }

  @keyframes prizeReveal {
    0% { transform: scale(0) rotate(-20deg); opacity: 0; }
    60% { transform: scale(1.28) rotate(6deg); opacity: 1; }
    80% { transform: scale(0.94) rotate(-2deg); }
    100% { transform: scale(1) rotate(0); }
  }

  .prize-big-name {
    font-family: 'Fredoka One', cursive;
    font-size: 1.55rem;
    color: white;
    margin-top: 8px;
    animation: slideUpFade 0.5s 0.7s both;
  }

  .prize-big-desc {
    color: rgba(255,255,255,0.6);
    font-size: 0.88rem;
    margin-top: 4px;
    animation: slideUpFade 0.5s 0.9s both;
    line-height: 1.45;
  }

  @keyframes slideUpFade {
    from { opacity: 0; transform: translateY(14px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .order-summary-modal {
    background: rgba(255,255,255,0.06);
    border-radius: 14px;
    padding: 14px 16px;
    margin: 16px 0 12px;
    text-align: left;
    border: 1px solid rgba(255,255,255,0.1);
    animation: slideUpFade 0.5s 1s both;
  }

  .order-sum-title {
    font-size: 0.72rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: rgba(255,255,255,0.3);
    margin-bottom: 8px;
    font-weight: 700;
  }

  .order-sum-item {
    display: flex;
    justify-content: space-between;
    font-size: 0.86rem;
    color: rgba(255,255,255,0.65);
    padding: 3px 0;
  }

  .order-sum-total {
    display: flex;
    justify-content: space-between;
    font-family: 'Fredoka One', cursive;
    font-size: 1.05rem;
    color: var(--amarelo);
    padding-top: 8px;
    margin-top: 4px;
    border-top: 1px dashed rgba(255,255,255,0.15);
  }

  .order-sum-shelter {
    font-size: 0.78rem;
    color: #32BCAD;
    font-weight: 600;
    margin-top: 6px;
    text-align: center;
  }

  .close-modal-btn {
    background: linear-gradient(135deg, var(--amarelo), var(--laranja));
    color: white;
    border: none;
    padding: 14px 44px;
    font-family: 'Fredoka One', cursive;
    font-size: 1.2rem;
    border-radius: 50px;
    cursor: pointer;
    box-shadow: 0 4px 0 rgba(0,0,0,0.3), 0 0 20px rgba(245,197,24,0.25);
    transition: all 0.2s;
    animation: slideUpFade 0.5s 1.1s both;
  }

  .close-modal-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 0 rgba(0,0,0,0.3), 0 0 32px rgba(245,197,24,0.5);
  }

  /* CONFETTI STARS */
  .star {
    position: fixed;
    font-size: 1.5rem;
    animation: starFloat 1.5s ease-out both;
    pointer-events: none;
    z-index: 9999;
  }

  @keyframes starFloat {
    0% { transform: scale(0) rotate(0deg); opacity: 1; }
    50% { transform: scale(1.5) rotate(180deg); opacity: 1; }
    100% { transform: scale(0) rotate(360deg) translateY(-80px); opacity: 0; }
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  @keyframes rotate {
    to { transform: rotate(360deg); }
  }

  @keyframes tada {
    0%,100% { transform: scale(1); }
    20% { transform: scale(1.1) rotate(-3deg); }
    40% { transform: scale(1.1) rotate(3deg); }
    60% { transform: scale(1.1) rotate(-3deg); }
    80% { transform: scale(1.1) rotate(3deg); }
  }

  /* PAYMENT SELECTOR */
  .payment-selector {
    margin-bottom: 16px;
    animation: slideUpFade 0.35s ease both;
  }

  @keyframes slideUpFade {
    from { opacity: 0; transform: translateY(12px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  .payment-label {
    font-family: 'Fredoka One', cursive;
    font-size: 0.9rem;
    color: #888;
    margin-bottom: 10px;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .payment-methods {
    display: flex;
    gap: 12px;
    justify-content: center;
    flex-wrap: wrap;
  }

  .pay-method-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    padding: 14px 28px;
    border-radius: 16px;
    border: 2px solid transparent;
    cursor: pointer;
    font-family: 'Baloo 2', cursive;
    transition: all 0.22s;
    min-width: 130px;
  }

  .pay-method-btn span {
    font-family: 'Fredoka One', cursive;
    font-size: 1.1rem;
  }

  .pay-method-btn small {
    font-size: 0.72rem;
    opacity: 0.7;
  }

  .pay-pix {
    background: linear-gradient(135deg, #32BCAD, #1a9a8e);
    color: white;
    box-shadow: 0 4px 0 #0e7a70, 0 0 16px rgba(50,188,173,0.3);
  }

  .pay-pix:hover {
    transform: translateY(-3px);
    box-shadow: 0 7px 0 #0e7a70, 0 0 24px rgba(50,188,173,0.5);
  }

  .pay-sol {
    background: linear-gradient(135deg, #1a0533, #2d0a5e);
    color: white;
    border-color: rgba(153,69,255,0.5);
    box-shadow: 0 4px 0 #10022a, 0 0 16px rgba(153,69,255,0.3);
    position: relative;
    overflow: hidden;
  }

  .pay-sol::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(0,255,163,0.08), rgba(220,31,255,0.08));
    pointer-events: none;
  }

  .pay-sol:hover {
    transform: translateY(-3px);
    box-shadow: 0 7px 0 #10022a, 0 0 28px rgba(153,69,255,0.5);
    border-color: rgba(153,69,255,0.9);
  }

  .pay-mp {
    background: linear-gradient(135deg, #009ee3, #0077b6);
    color: white;
    box-shadow: 0 4px 0 #005a8c, 0 0 16px rgba(0,158,227,0.3);
    position: relative;
    overflow: hidden;
  }

  .pay-mp::before {
    content: '';
    position: absolute;
    top: 0; left: -100%;
    width: 60%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
    animation: shine 3s infinite;
    pointer-events: none;
  }

  .pay-mp:hover {
    transform: translateY(-3px);
    box-shadow: 0 7px 0 #005a8c, 0 0 28px rgba(0,158,227,0.5);
  }

  .pay-mp .mp-badge {
    font-size: 0.6rem;
    background: rgba(255,255,255,0.2);
    padding: 1px 8px;
    border-radius: 10px;
    margin-top: 2px;
    letter-spacing: 0.5px;
  }

  /* SOLANA MODAL */
  .sol-modal {
    background: #0a0118;
    border-radius: 24px;
    padding: 28px 24px;
    max-width: 420px;
    width: 93%;
    text-align: center;
    position: relative;
    transform: scale(0.7) translateY(40px);
    transition: transform 0.45s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    border: 1px solid rgba(153,69,255,0.3);
    box-shadow: 0 0 60px rgba(153,69,255,0.15), 0 0 0 1px rgba(0,255,163,0.05);
    max-height: 94vh;
    overflow-y: auto;
  }

  .modal-overlay.active .sol-modal {
    transform: scale(1) translateY(0);
  }

  .sol-modal::before {
    content: '';
    position: absolute;
    inset: 0;
    background:
      radial-gradient(ellipse at 30% 0%, rgba(0,255,163,0.07) 0%, transparent 50%),
      radial-gradient(ellipse at 70% 100%, rgba(220,31,255,0.08) 0%, transparent 50%);
    pointer-events: none;
    border-radius: 24px;
  }

  .sol-modal::after {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 3px;
    background: linear-gradient(90deg, #00FFA3, #9945FF, #DC1FFF, #00FFA3);
    background-size: 200%;
    animation: solGradientMove 3s linear infinite;
    border-radius: 24px 24px 0 0;
  }

  @keyframes solGradientMove {
    0% { background-position: 0%; }
    100% { background-position: 200%; }
  }

  .sol-header {
    display: flex;
    align-items: center;
    gap: 14px;
    margin-bottom: 6px;
    justify-content: center;
  }

  .sol-logo-wrap {
    background: rgba(255,255,255,0.05);
    border-radius: 12px;
    padding: 8px;
    border: 1px solid rgba(153,69,255,0.3);
  }

  .sol-title {
    font-family: 'Fredoka One', cursive;
    font-size: 1.5rem;
    background: linear-gradient(90deg, #00FFA3, #9945FF);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-align: left;
    line-height: 1;
  }

  .sol-subtitle {
    font-size: 0.78rem;
    color: rgba(255,255,255,0.4);
    text-align: left;
    margin-top: 2px;
  }

  .sol-amount-box {
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(153,69,255,0.25);
    border-radius: 16px;
    padding: 16px;
    margin: 16px 0;
  }

  .sol-amount-row {
    display: flex;
    align-items: center;
    justify-content: space-around;
    gap: 10px;
  }

  .sol-amount-label {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: rgba(255,255,255,0.35);
    margin-bottom: 4px;
  }

  .sol-amount-brl {
    font-family: 'Fredoka One', cursive;
    font-size: 1.4rem;
    color: white;
  }

  .sol-equals {
    font-size: 1.6rem;
    color: rgba(255,255,255,0.2);
    font-weight: 300;
  }

  .sol-amount-sol {
    font-family: 'Fredoka One', cursive;
    font-size: 1.4rem;
    background: linear-gradient(90deg, #00FFA3, #9945FF);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .sol-loading {
    animation: spin 1s linear infinite;
    display: inline-block;
    -webkit-text-fill-color: rgba(153,69,255,0.6);
  }

  .sol-rate-note {
    font-size: 0.72rem;
    color: rgba(255,255,255,0.3);
    margin-top: 8px;
    text-align: center;
  }

  .sol-qr-wrap {
    position: relative;
    display: inline-block;
    margin: 8px auto 14px;
    padding: 14px;
    background: white;
    border-radius: 16px;
    box-shadow: 0 0 0 2px rgba(153,69,255,0.5), 0 0 24px rgba(153,69,255,0.25);
  }

  .sol-qr-cat {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    border-radius: 8px;
    padding: 3px 5px;
    font-size: 1rem;
    font-family: 'Fredoka One', cursive;
    color: #9945FF;
    font-weight: 900;
  }

  .sol-address-section {
    background: rgba(0,255,163,0.04);
    border: 1px dashed rgba(0,255,163,0.25);
    border-radius: 12px;
    padding: 12px 14px;
    margin-bottom: 12px;
  }

  .sol-address-label {
    font-size: 0.72rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: rgba(255,255,255,0.3);
    margin-bottom: 6px;
    font-weight: 700;
  }

  .sol-address-value {
    font-family: 'Courier New', monospace;
    font-size: 0.72rem;
    color: #00FFA3;
    word-break: break-all;
    margin-bottom: 10px;
    letter-spacing: 0.5px;
  }

  .sol-copy-btn {
    background: rgba(0,255,163,0.15);
    color: #00FFA3;
    border: 1px solid rgba(0,255,163,0.3);
    padding: 7px 18px;
    border-radius: 20px;
    font-family: 'Fredoka One', cursive;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s;
  }

  .sol-copy-btn:hover { background: rgba(0,255,163,0.25); }
  .sol-copy-btn.copied { background: rgba(0,255,163,0.3); color: white; }

  .sol-network-badge {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    font-size: 0.75rem;
    color: rgba(255,255,255,0.35);
    margin-bottom: 14px;
  }

  .sol-dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    background: #14F195;
    box-shadow: 0 0 6px #14F195;
    animation: solDotPulse 1.5s ease-in-out infinite;
  }

  @keyframes solDotPulse {
    0%,100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.6; transform: scale(0.8); }
  }

  .confirm-sol-btn {
    background: linear-gradient(135deg, #9945FF, #DC1FFF);
    color: white;
    border: none;
    padding: 14px 40px;
    font-family: 'Fredoka One', cursive;
    font-size: 1.2rem;
    border-radius: 50px;
    cursor: pointer;
    box-shadow: 0 4px 0 rgba(0,0,0,0.4), 0 0 24px rgba(153,69,255,0.4);
    transition: all 0.2s;
    width: 100%;
    margin-bottom: 10px;
    position: relative;
    overflow: hidden;
  }

  .confirm-sol-btn::before {
    content: '';
    position: absolute;
    top: 0; left: -100%;
    width: 60%; height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
    animation: shine 2.5s infinite;
  }

  .confirm-sol-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 0 rgba(0,0,0,0.4), 0 0 36px rgba(153,69,255,0.6);
  }

  /* PIX MODAL */
  .pix-modal {
    background: var(--creme);
    border-radius: 24px;
    padding: 32px 28px;
    max-width: 420px;
    width: 92%;
    text-align: center;
    position: relative;
    transform: scale(0.7) translateY(40px);
    transition: transform 0.45s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    overflow: hidden;
    max-height: 92vh;
    overflow-y: auto;
  }

  .modal-overlay.active .pix-modal {
    transform: scale(1) translateY(0);
  }

  .pix-modal::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 8px;
    background: repeating-linear-gradient(90deg, #32BCAD 0,#32BCAD 20px, var(--amarelo) 20px, var(--amarelo) 40px, var(--verde) 40px, var(--verde) 60px, #32BCAD 60px, #32BCAD 80px);
  }

  .pix-header {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-bottom: 4px;
  }

  .pix-logo {
    width: 36px;
    height: 36px;
  }

  .pix-title {
    font-family: 'Fredoka One', cursive;
    font-size: 1.6rem;
    color: #32BCAD;
  }

  .pix-subtitle {
    color: #888;
    font-size: 0.88rem;
    margin-bottom: 20px;
  }

  .pix-amount-box {
    background: linear-gradient(135deg, #32BCAD, #1a9a8e);
    border-radius: 16px;
    padding: 16px;
    margin-bottom: 20px;
    color: white;
  }

  .pix-amount-label {
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    opacity: 0.8;
    margin-bottom: 4px;
  }

  .pix-amount-value {
    font-family: 'Fredoka One', cursive;
    font-size: 2.2rem;
    text-shadow: 0 2px 8px rgba(0,0,0,0.2);
  }

  .pix-amount-dest {
    font-size: 0.78rem;
    opacity: 0.85;
    margin-top: 4px;
  }

  .qr-wrapper {
    background: white;
    border-radius: 16px;
    padding: 16px;
    display: inline-block;
    margin: 0 auto 16px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.1);
    border: 3px solid #32BCAD;
    position: relative;
  }

  .qr-wrapper canvas {
    display: block;
  }

  .qr-cat-overlay {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    border-radius: 8px;
    padding: 4px;
    font-size: 1.6rem;
    line-height: 1;
  }

  .pix-timer {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    margin-bottom: 16px;
    font-size: 0.88rem;
    color: #888;
  }

  .timer-circle {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: 3px solid #eee;
    border-top-color: #32BCAD;
    animation: spin 1s linear infinite;
    flex-shrink: 0;
  }

  .timer-num {
    font-family: 'Fredoka One', cursive;
    font-size: 1.1rem;
    color: var(--laranja);
    min-width: 32px;
  }

  .pix-key-section {
    background: #f0faf9;
    border-radius: 12px;
    padding: 12px 16px;
    margin-bottom: 16px;
    border: 1.5px dashed #32BCAD;
  }

  .pix-key-label {
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: #888;
    margin-bottom: 6px;
    font-weight: 700;
  }

  .pix-key-value {
    font-family: 'Baloo 2', cursive;
    font-size: 0.85rem;
    color: var(--marrom);
    font-weight: 700;
    word-break: break-all;
    margin-bottom: 8px;
  }

  .copy-btn {
    background: #32BCAD;
    color: white;
    border: none;
    padding: 8px 20px;
    border-radius: 20px;
    font-family: 'Fredoka One', cursive;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 2px 0 #1a9a8e;
  }

  .copy-btn:hover { background: #28a89a; transform: translateY(-1px); }
  .copy-btn.copied { background: var(--verde); }

  .pix-steps {
    text-align: left;
    background: white;
    border-radius: 12px;
    padding: 14px 16px;
    margin-bottom: 16px;
    border: 1px solid #eee;
  }

  .pix-steps-title {
    font-size: 0.78rem;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: #aaa;
    margin-bottom: 10px;
  }

  .pix-step-item {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    margin-bottom: 8px;
    font-size: 0.82rem;
    color: var(--marrom);
  }

  .pix-step-num {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: #32BCAD;
    color: white;
    font-size: 0.7rem;
    font-weight: 900;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    margin-top: 1px;
  }

  .confirm-pix-btn {
    background: linear-gradient(135deg, #32BCAD, #1a9a8e);
    color: white;
    border: none;
    padding: 14px 40px;
    font-family: 'Fredoka One', cursive;
    font-size: 1.2rem;
    border-radius: 50px;
    cursor: pointer;
    box-shadow: 0 4px 0 #12766e, 0 6px 16px rgba(50,188,173,0.4);
    transition: all 0.2s;
    width: 100%;
    margin-bottom: 10px;
  }

  .confirm-pix-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 0 #12766e, 0 8px 20px rgba(50,188,173,0.4);
  }

  .back-pix-btn {
    background: none;
    border: 2px solid #ddd;
    color: #aaa;
    padding: 10px 28px;
    font-family: 'Fredoka One', cursive;
    font-size: 1rem;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .back-pix-btn:hover { border-color: #bbb; color: #888; }

  /* PIX confirming animation */
  .pix-confirming {
    padding: 20px 0;
  }

  .pix-confirming-icon {
    font-size: 4rem;
    animation: tada 0.8s both;
    display: block;
    margin-bottom: 12px;
  }

  .pix-confirming-text {
    font-family: 'Fredoka One', cursive;
    font-size: 1.3rem;
    color: #32BCAD;
  }

  .pix-confirming-sub {
    color: #aaa;
    font-size: 0.85rem;
    margin-top: 6px;
  }

  /* SHARE SECTION */
  .share-section {
    margin: 14px 0 16px;
    animation: slideUpFade 0.5s 1.2s both;
  }

  .share-label {
    font-family: 'Fredoka One', cursive;
    font-size: 0.85rem;
    color: rgba(255,255,255,0.45);
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-bottom: 12px;
  }

  .share-card {
    border-radius: 18px;
    overflow: hidden;
    position: relative;
    margin-bottom: 14px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.4);
  }

  .share-card-bg {
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, #1a7a4a 0%, #0d4a2e 40%, #1e4fa8 100%);
  }

  .share-card-bg::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image: repeating-linear-gradient(
      45deg,
      rgba(255,255,255,0.03) 0px,
      rgba(255,255,255,0.03) 2px,
      transparent 2px,
      transparent 20px
    );
  }

  .share-card-bg::after {
    content: '';
    position: absolute;
    top: -40px; right: -40px;
    width: 160px; height: 160px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(245,197,24,0.18) 0%, transparent 70%);
  }

  .share-card-inner {
    position: relative;
    padding: 18px 20px;
    text-align: left;
  }

  .share-card-top {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 14px;
    border-bottom: 1px solid rgba(255,255,255,0.12);
    padding-bottom: 12px;
  }

  .share-cat-icon {
    font-size: 2rem;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
  }

  .share-card-brand {
    font-family: 'Fredoka One', cursive;
    font-size: 1.1rem;
    color: var(--amarelo);
    line-height: 1;
  }

  .share-card-sub {
    font-size: 0.75rem;
    color: rgba(255,255,255,0.65);
    margin-top: 2px;
  }

  .share-prize-row {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 12px;
  }

  .share-prize-row > span {
    font-size: 2.2rem;
    filter: drop-shadow(0 2px 6px rgba(0,0,0,0.4));
  }

  .share-prize-label {
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--amarelo);
    margin-bottom: 2px;
  }

  .share-prize-name {
    font-family: 'Fredoka One', cursive;
    font-size: 1rem;
    color: white;
  }

  .share-shelter-row {
    font-size: 0.8rem;
    color: rgba(255,255,255,0.7);
    margin-bottom: 12px;
    padding: 6px 10px;
    background: rgba(0,0,0,0.2);
    border-radius: 8px;
  }

  .share-footer-row {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .share-footer-row span {
    font-size: 0.72rem;
    color: rgba(255,255,255,0.5);
    font-weight: 700;
  }

  .share-buttons {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
  }

  .share-btn {
    border: none;
    padding: 11px 20px;
    border-radius: 30px;
    font-family: 'Fredoka One', cursive;
    font-size: 0.95rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s;
    flex: 1;
    justify-content: center;
    min-width: 140px;
  }

  .share-ig {
    background: linear-gradient(135deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888);
    color: white;
    box-shadow: 0 4px 0 rgba(0,0,0,0.25), 0 0 16px rgba(220,39,67,0.3);
  }

  .share-ig:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 0 rgba(0,0,0,0.25), 0 0 24px rgba(220,39,67,0.5);
  }

  .share-copy {
    background: rgba(255,255,255,0.12);
    color: rgba(255,255,255,0.85);
    border: 1px solid rgba(255,255,255,0.2);
  }

  .share-copy:hover {
    background: rgba(255,255,255,0.2);
    transform: translateY(-2px);
  }

  .share-copy.copied {
    background: #32BCAD;
    color: white;
    border-color: #32BCAD;
  }

  @media (max-width: 640px) {
    .header-content { padding: 12px 16px; }
    .logo-text h1 { font-size: 1.4rem; }
    main { padding: 20px 12px; }
    .shelf-items { gap: 8px; }
    .item-card { width: 110px; padding: 10px; }
    .item-emoji { font-size: 2.2rem; }
    .shelters-grid { grid-template-columns: repeat(2, 1fr); }
    .step-label { font-size: 0.6rem; }
    .steps-bar { gap: 0; }
    .step { padding: 0 12px; }
  }
</style>
</head>
<body>

<header>
  <div class="header-azulejo"></div>
  <div class="header-content">
    <div class="logo">
      <div class="logo-icon">üê±</div>
      <div class="logo-text">
        <h1>Gatinhos do Rio</h1>
        <p>Adote um sorriso, doe um prato üåä</p>
      </div>
    </div>
    <button class="cart-btn" onclick="scrollToCart()">
      üõí Carrinho
      <span class="cart-count" id="cartCount">0</span>
    </button>
  </div>
  <div class="tab-nav">
    <button class="tab-btn active" id="tabShop" onclick="switchTab('shop')">üõí Loja</button>
    <button class="tab-btn" id="tabGame" onclick="switchTab('game')">üéÆ Jogo</button>
  </div>
</header>

<div id="shopContent">
<div class="hero">
  <div class="hero-tiles"></div>
  <h2>üå¥ Doe para um <span>felino carioca</span> üêæ</h2>
  <p>Escolha os itens, selecione um abrigo do Rio e concorra a brindes!</p>
  <div class="steps-bar">
    <div class="step"><div class="step-num">1</div><div class="step-label">Escolha o Abrigo</div></div>
    <div class="step"><div class="step-num">2</div><div class="step-label">Monte a Cesta</div></div>
    <div class="step"><div class="step-num">3</div><div class="step-label">Doe & Raffle!</div></div>
  </div>
</div>

<main>

  <!-- SHELTER SELECTION -->
  <div class="section-title">üè† Escolha um abrigo do Rio</div>
  <div class="section-subtitle">Todos os itens ser√£o entregues diretamente ao abrigo escolhido</div>

  <div class="shelters-grid" id="shelterGrid">
    <div class="shelter-card" onclick="selectShelter(this, 'Gatinhos da Lapa')" data-shelter="Gatinhos da Lapa">
      <div class="shelter-emoji">üê±</div>
      <div class="shelter-name">Gatinhos da Lapa</div>
      <div class="shelter-neighborhood">üìç Lapa / Centro</div>
      <div class="shelter-cats">üêæ 47 gatos</div>
    </div>
    <div class="shelter-card" onclick="selectShelter(this, 'Abrigo Copacabana')" data-shelter="Abrigo Copacabana">
      <div class="shelter-emoji">üåä</div>
      <div class="shelter-name">Abrigo Copacabana</div>
      <div class="shelter-neighborhood">üìç Copacabana</div>
      <div class="shelter-cats">üêæ 32 gatos</div>
    </div>
    <div class="shelter-card" onclick="selectShelter(this, 'Felinos de Santa Teresa')" data-shelter="Felinos de Santa Teresa">
      <div class="shelter-emoji">üé®</div>
      <div class="shelter-name">Felinos de Sta Teresa</div>
      <div class="shelter-neighborhood">üìç Santa Teresa</div>
      <div class="shelter-cats">üêæ 61 gatos</div>
    </div>
    <div class="shelter-card" onclick="selectShelter(this, 'Resgate Tijuca')" data-shelter="Resgate Tijuca">
      <div class="shelter-emoji">üåø</div>
      <div class="shelter-name">Resgate Tijuca</div>
      <div class="shelter-neighborhood">üìç Tijuca</div>
      <div class="shelter-cats">üêæ 28 gatos</div>
    </div>
    <div class="shelter-card" onclick="selectShelter(this, 'Gatil Botafogo')" data-shelter="Gatil Botafogo">
      <div class="shelter-emoji">‚õµ</div>
      <div class="shelter-name">Gatil Botafogo</div>
      <div class="shelter-neighborhood">üìç Botafogo</div>
      <div class="shelter-cats">üêæ 55 gatos</div>
    </div>
    <div class="shelter-card" onclick="selectShelter(this, 'Col√¥nia Barra da Tijuca')" data-shelter="Col√¥nia Barra da Tijuca">
      <div class="shelter-emoji">üèñÔ∏è</div>
      <div class="shelter-name">Col√¥nia Barra</div>
      <div class="shelter-neighborhood">üìç Barra da Tijuca</div>
      <div class="shelter-cats">üêæ 39 gatos</div>
    </div>
  </div>

  <!-- STORE SHELVES -->
  <div class="section-title">üõí Prateleiras do Armaz√©m</div>
  <div class="section-subtitle">Clique nos itens para adicionar √† sua cesta de doa√ß√£o</div>
  <div class="gami-badge">üéÆ Preencha a cesta e ganhe pontos + raffle!</div>

  <div class="store-container">
    <div class="store-bg">

      <!-- SHELF 1: Comida Seca -->
      <div class="shelf">
        <div class="shelf-label">üêæ Ra√ß√£o & Petiscos</div>
        <div class="shelf-items">
          <div class="item-card" onclick="addItem(this)" data-name="Ra√ß√£o Premium 3kg" data-price="45.00" data-emoji="ü•£">
            <span class="add-sticker">+pontos</span>
            <span class="item-emoji">ü•£</span>
            <div class="item-name">Ra√ß√£o Premium 3kg</div>
            <div class="item-price">R$ 45,00</div>
            <div class="item-qty" style="display:none">
              <button class="qty-btn" onclick="changeQty(event,-1,this)">‚àí</button>
              <span class="qty-num">1</span>
              <button class="qty-btn" onclick="changeQty(event,1,this)">+</button>
            </div>
          </div>
          <div class="item-card" onclick="addItem(this)" data-name="Ra√ß√£o Filhote 1kg" data-price="22.00" data-emoji="üçö">
            <span class="item-emoji">üçö</span>
            <div class="item-name">Ra√ß√£o Filhote 1kg</div>
            <div class="item-price">R$ 22,00</div>
            <div class="item-qty" style="display:none">
              <button class="qty-btn" onclick="changeQty(event,-1,this)">‚àí</button>
              <span class="qty-num">1</span>
              <button class="qty-btn" onclick="changeQty(event,1,this)">+</button>
            </div>
          </div>
          <div class="item-card" onclick="addItem(this)" data-name="Petisco Temptations" data-price="18.00" data-emoji="üç™">
            <span class="item-emoji">üç™</span>
            <div class="item-name">Petisco Temptations</div>
            <div class="item-price">R$ 18,00</div>
            <div class="item-qty" style="display:none">
              <button class="qty-btn" onclick="changeQty(event,-1,this)">‚àí</button>
              <span class="qty-num">1</span>
              <button class="qty-btn" onclick="changeQty(event,1,this)">+</button>
            </div>
          </div>
          <div class="item-card" onclick="addItem(this)" data-name="Sach√™ Wet Food (12un)" data-price="36.00" data-emoji="ü•´">
            <span class="add-sticker">Popular</span>
            <span class="item-emoji">ü•´</span>
            <div class="item-name">Sach√™ Wet Food 12un</div>
            <div class="item-price">R$ 36,00</div>
            <div class="item-qty" style="display:none">
              <button class="qty-btn" onclick="changeQty(event,-1,this)">‚àí</button>
              <span class="qty-num">1</span>
              <button class="qty-btn" onclick="changeQty(event,1,this)">+</button>
            </div>
          </div>
          <div class="item-card" onclick="addItem(this)" data-name="Ra√ß√£o Castratos 2kg" data-price="38.00" data-emoji="‚öñÔ∏è">
            <span class="item-emoji">‚öñÔ∏è</span>
            <div class="item-name">Ra√ß√£o Castratos 2kg</div>
            <div class="item-price">R$ 38,00</div>
            <div class="item-qty" style="display:none">
              <button class="qty-btn" onclick="changeQty(event,-1,this)">‚àí</button>
              <span class="qty-num">1</span>
              <button class="qty-btn" onclick="changeQty(event,1,this)">+</button>
            </div>
          </div>
        </div>
      </div>

      <!-- SHELF 2: Higiene -->
      <div class="shelf">
        <div class="shelf-label">üßπ Higiene & Caixinha</div>
        <div class="shelf-items">
          <div class="item-card" onclick="addItem(this)" data-name="Areia Higi√™nica 4kg" data-price="28.00" data-emoji="ü™£">
            <span class="item-emoji">ü™£</span>
            <div class="item-name">Areia Higi√™nica 4kg</div>
            <div class="item-price">R$ 28,00</div>
            <div class="item-qty" style="display:none">
              <button class="qty-btn" onclick="changeQty(event,-1,this)">‚àí</button>
              <span class="qty-num">1</span>
              <button class="qty-btn" onclick="changeQty(event,1,this)">+</button>
            </div>
          </div>
          <div class="item-card" onclick="addItem(this)" data-name="Areia S√≠lica 1.8kg" data-price="32.00" data-emoji="‚ú®">
            <span class="item-emoji">‚ú®</span>
            <div class="item-name">Areia S√≠lica 1.8kg</div>
            <div class="item-price">R$ 32,00</div>
            <div class="item-qty" style="display:none">
              <button class="qty-btn" onclick="changeQty(event,-1,this)">‚àí</button>
              <span class="qty-num">1</span>
              <button class="qty-btn" onclick="changeQty(event,1,this)">+</button>
            </div>
          </div>
          <div class="item-card" onclick="addItem(this)" data-name="Shampoo Seco Felino" data-price="24.00" data-emoji="üß¥">
            <span class="item-emoji">üß¥</span>
            <div class="item-name">Shampoo Seco Felino</div>
            <div class="item-price">R$ 24,00</div>
            <div class="item-qty" style="display:none">
              <button class="qty-btn" onclick="changeQty(event,-1,this)">‚àí</button>
              <span class="qty-num">1</span>
              <button class="qty-btn" onclick="changeQty(event,1,this)">+</button>
            </div>
          </div>
          <div class="item-card" onclick="addItem(this)" data-name="Caixa Higi√™nica Pl√°stica" data-price="55.00" data-emoji="üì¶">
            <span class="add-sticker">+pontos</span>
            <span class="item-emoji">üì¶</span>
            <div class="item-name">Caixa Higi√™nica</div>
            <div class="item-price">R$ 55,00</div>
            <div class="item-qty" style="display:none">
              <button class="qty-btn" onclick="changeQty(event,-1,this)">‚àí</button>
              <span class="qty-num">1</span>
              <button class="qty-btn" onclick="changeQty(event,1,this)">+</button>
            </div>
          </div>
          <div class="item-card" onclick="addItem(this)" data-name="Escova Dentes Gato" data-price="15.00" data-emoji="ü™•">
            <span class="item-emoji">ü™•</span>
            <div class="item-name">Escova Dentes Gato</div>
            <div class="item-price">R$ 15,00</div>
            <div class="item-qty" style="display:none">
              <button class="qty-btn" onclick="changeQty(event,-1,this)">‚àí</button>
              <span class="qty-num">1</span>
              <button class="qty-btn" onclick="changeQty(event,1,this)">+</button>
            </div>
          </div>
        </div>
      </div>

      <!-- SHELF 3: Sa√∫de -->
      <div class="shelf">
        <div class="shelf-label">üíä Sa√∫de & Bem-estar</div>
        <div class="shelf-items">
          <div class="item-card" onclick="addItem(this)" data-name="Antipulgas Spot-On" data-price="42.00" data-emoji="üêõ">
            <span class="add-sticker">Urgente</span>
            <span class="item-emoji">üêõ</span>
            <div class="item-name">Antipulgas Spot-On</div>
            <div class="item-price">R$ 42,00</div>
            <div class="item-qty" style="display:none">
              <button class="qty-btn" onclick="changeQty(event,-1,this)">‚àí</button>
              <span class="qty-num">1</span>
              <button class="qty-btn" onclick="changeQty(event,1,this)">+</button>
            </div>
          </div>
          <div class="item-card" onclick="addItem(this)" data-name="Verm√≠fugo Comprimido" data-price="25.00" data-emoji="üíä">
            <span class="item-emoji">üíä</span>
            <div class="item-name">Verm√≠fugo Comprimido</div>
            <div class="item-price">R$ 25,00</div>
            <div class="item-qty" style="display:none">
              <button class="qty-btn" onclick="changeQty(event,-1,this)">‚àí</button>
              <span class="qty-num">1</span>
              <button class="qty-btn" onclick="changeQty(event,1,this)">+</button>
            </div>
          </div>
          <div class="item-card" onclick="addItem(this)" data-name="Suplemento Vitam√≠nico" data-price="35.00" data-emoji="üíâ">
            <span class="item-emoji">üíâ</span>
            <div class="item-name">Suplemento Vitam√≠nico</div>
            <div class="item-price">R$ 35,00</div>
            <div class="item-qty" style="display:none">
              <button class="qty-btn" onclick="changeQty(event,-1,this)">‚àí</button>
              <span class="qty-num">1</span>
              <button class="qty-btn" onclick="changeQty(event,1,this)">+</button>
            </div>
          </div>
          <div class="item-card" onclick="addItem(this)" data-name="Coleira Anti-parasita" data-price="29.00" data-emoji="üîñ">
            <span class="item-emoji">üîñ</span>
            <div class="item-name">Coleira Anti-parasita</div>
            <div class="item-price">R$ 29,00</div>
            <div class="item-qty" style="display:none">
              <button class="qty-btn" onclick="changeQty(event,-1,this)">‚àí</button>
              <span class="qty-num">1</span>
              <button class="qty-btn" onclick="changeQty(event,1,this)">+</button>
            </div>
          </div>
        </div>
      </div>

      <!-- SHELF 4: Conforto -->
      <div class="shelf">
        <div class="shelf-label">üõãÔ∏è Conforto & Brinquedos</div>
        <div class="shelf-items">
          <div class="item-card" onclick="addItem(this)" data-name="Caminha Quentinha" data-price="65.00" data-emoji="üõèÔ∏è">
            <span class="add-sticker">+pontos</span>
            <span class="item-emoji">üõèÔ∏è</span>
            <div class="item-name">Caminha Quentinha</div>
            <div class="item-price">R$ 65,00</div>
            <div class="item-qty" style="display:none">
              <button class="qty-btn" onclick="changeQty(event,-1,this)">‚àí</button>
              <span class="qty-num">1</span>
              <button class="qty-btn" onclick="changeQty(event,1,this)">+</button>
            </div>
          </div>
          <div class="item-card" onclick="addItem(this)" data-name="Arranhador Sisal" data-price="48.00" data-emoji="üåµ">
            <span class="item-emoji">üåµ</span>
            <div class="item-name">Arranhador Sisal</div>
            <div class="item-price">R$ 48,00</div>
            <div class="item-qty" style="display:none">
              <button class="qty-btn" onclick="changeQty(event,-1,this)">‚àí</button>
              <span class="qty-num">1</span>
              <button class="qty-btn" onclick="changeQty(event,1,this)">+</button>
            </div>
          </div>
          <div class="item-card" onclick="addItem(this)" data-name="Kit Brinquedos (5 pe√ßas)" data-price="35.00" data-emoji="üéæ">
            <span class="item-emoji">üéæ</span>
            <div class="item-name">Kit Brinquedos 5 pe√ßas</div>
            <div class="item-price">R$ 35,00</div>
            <div class="item-qty" style="display:none">
              <button class="qty-btn" onclick="changeQty(event,-1,this)">‚àí</button>
              <span class="qty-num">1</span>
              <button class="qty-btn" onclick="changeQty(event,1,this)">+</button>
            </div>
          </div>
          <div class="item-card" onclick="addItem(this)" data-name="Cobertor Polar" data-price="40.00" data-emoji="üß£">
            <span class="item-emoji">üß£</span>
            <div class="item-name">Cobertor Polar</div>
            <div class="item-price">R$ 40,00</div>
            <div class="item-qty" style="display:none">
              <button class="qty-btn" onclick="changeQty(event,-1,this)">‚àí</button>
              <span class="qty-num">1</span>
              <button class="qty-btn" onclick="changeQty(event,1,this)">+</button>
            </div>
          </div>
          <div class="item-card" onclick="addItem(this)" data-name="Bebedouro Fonte 1.5L" data-price="72.00" data-emoji="‚õ≤">
            <span class="add-sticker">Fav!</span>
            <span class="item-emoji">‚õ≤</span>
            <div class="item-name">Bebedouro Fonte 1.5L</div>
            <div class="item-price">R$ 72,00</div>
            <div class="item-qty" style="display:none">
              <button class="qty-btn" onclick="changeQty(event,-1,this)">‚àí</button>
              <span class="qty-num">1</span>
              <button class="qty-btn" onclick="changeQty(event,1,this)">+</button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- CART -->
  <div id="cartSection">
    <div class="section-title">üõí Sua Cesta de Doa√ß√£o</div>
    <div class="section-subtitle" id="shelterSelectedMsg">Selecione um abrigo acima antes de finalizar</div>

    <div class="cart-panel">
      <div id="cartContent">
        <div class="cart-empty">
          <span>üê±</span>
          Nenhum item ainda... Escolha algo na prateleira!
        </div>
      </div>
    </div>

    <!-- PROGRESS -->
    <div id="progressSection" style="display:none">
      <div class="progress-container">
        <div class="progress-bar" id="progressBar" style="width:0%"></div>
      </div>
      <div class="progress-label">
        <span id="progressText">0 de 3 itens para desbloquear raffle!</span>
        <span id="progressPct">0%</span>
      </div>
    </div>

    <div class="cta-section">
      <div class="payment-selector" id="paymentSelector" style="display:none">
        <div class="payment-label">Escolha como pagar:</div>
        <div class="payment-methods">
          <button class="pay-method-btn pay-pix" onclick="openPixModal()">
            <svg width="22" height="22" viewBox="0 0 64 64" fill="none"><path d="M32 4L4 32L32 60L60 32L32 4Z" fill="white"/><path d="M20 32L28 24L36 32L28 40L20 32Z" fill="#32BCAD"/><path d="M28 32L36 24L44 32L36 40L28 32Z" fill="#32BCAD" opacity="0.6"/></svg>
            <span>Pix</span>
            <small>Instant√¢neo</small>
          </button>
          <button class="pay-method-btn pay-mp" onclick="openMercadoPago()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="white"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/><circle cx="12" cy="12" r="9" fill="none" stroke="white" stroke-width="1.5"/><text x="12" y="16" text-anchor="middle" font-size="11" font-weight="bold" fill="white">$</text></svg>
            <span>Mercado Pago</span>
            <small>Pix ‚Ä¢ Cart√£o ‚Ä¢ Boleto</small>
            <div class="mp-badge">‚úÖ Pagamento real</div>
          </button>
          <button class="pay-method-btn pay-sol" onclick="openSolModal()">
            <svg width="22" height="22" viewBox="0 0 397 311" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M64.6 237.9c2.4-2.4 5.7-3.8 9.2-3.8h317.4c5.8 0 8.7 7 4.6 11.1l-62.7 62.7c-2.4 2.4-5.7 3.8-9.2 3.8H6.5c-5.8 0-8.7-7-4.6-11.1l62.7-62.7z" fill="url(#sg1)"/><path d="M64.6 3.8C67.1 1.4 70.4 0 73.8 0h317.4c5.8 0 8.7 7 4.6 11.1l-62.7 62.7c-2.4 2.4-5.7 3.8-9.2 3.8H6.5c-5.8 0-8.7-7-4.6-11.1L64.6 3.8z" fill="url(#sg2)"/><path d="M333.1 120.1c-2.4-2.4-5.7-3.8-9.2-3.8H6.5c-5.8 0-8.7 7-4.6 11.1l62.7 62.7c2.4 2.4 5.7 3.8 9.2 3.8h317.4c5.8 0 8.7-7 4.6-11.1l-62.7-62.7z" fill="url(#sg3)"/><defs><linearGradient id="sg1" x1="360" y1="351" x2="146" y2="-67" gradientUnits="userSpaceOnUse"><stop stop-color="#00FFA3"/><stop offset="1" stop-color="#DC1FFF"/></linearGradient><linearGradient id="sg2" x1="264" y1="401" x2="50" y2="-17" gradientUnits="userSpaceOnUse"><stop stop-color="#00FFA3"/><stop offset="1" stop-color="#DC1FFF"/></linearGradient><linearGradient id="sg3" x1="312" y1="376" x2="98" y2="-42" gradientUnits="userSpaceOnUse"><stop stop-color="#00FFA3"/><stop offset="1" stop-color="#DC1FFF"/></linearGradient></defs></svg>
            <span>Solana</span>
            <small>Cripto ‚óé</small>
          </button>
        </div>
      </div>
      <button class="donate-btn" id="donateBtn" onclick="showPaymentSelector()" disabled>
        üêæ Finalizar Doa√ß√£o
      </button>
      <div class="warning-msg" id="warningMsg">Adicione pelo menos 1 item e selecione um abrigo</div>
    </div>
  </div>

</main>
</div><!-- end shopContent -->
<div id="gameSection">
  <div class="game-wrapper">
    <div class="game-header">
      <div class="game-title">üèñÔ∏è Gatinho Corredor de Copacabana</div>
      <div class="game-stats">
        <div class="game-stat">üéØ <span id="gameScoreDisplay">0</span></div>
        <div class="game-stat">üéÅ <span id="gameCollectedDisplay">0</span></div>
        <div class="game-stat">‚ù§Ô∏è <span id="gameLivesDisplay">3</span></div>
      </div>
    </div>

    <div class="game-canvas-wrap" id="gameCanvasWrap">
      <canvas id="gameCanvas" width="900" height="320"></canvas>

      <!-- START OVERLAY -->
      <div class="game-overlay" id="gameOverlay">
        <div class="game-overlay-title">üèñÔ∏è Gatinho de Copacabana</div>
        <div class="game-overlay-sub">Corra pela praia, pule obst√°culos e colete doa√ß√µes!<br>Cada item coletado vale pontos para os abrigos üêæ</div>
        <button class="game-start-btn" onclick="startGame()">‚ñ∂ Come√ßar a correr!</button>
        <div class="game-instructions">
          <div class="game-key"><span class="key-badge">ESPA√áO</span> Pular</div>
          <div class="game-key"><span class="key-badge">‚Üë</span> Pular</div>
          <div class="game-key"><span class="key-badge">TAP</span> Pular (mobile)</div>
        </div>
      </div>

      <!-- GAME OVER OVERLAY -->
      <div class="game-overlay hidden" id="gameOverOverlay">
        <div class="game-overlay-title" id="gameOverTitle">üíÄ Fim de Jogo!</div>
        <div class="game-overlay-sub" id="gameOverSub">Voc√™ coletou 0 doa√ß√µes!</div>
        <button class="game-start-btn" onclick="startGame()">üîÑ Jogar de novo</button>
      </div>
    </div>

    <div class="game-score-board">
      <div class="score-item">
        <div class="score-item-label">Pontos</div>
        <div class="score-item-value" id="scoreBoardScore">0</div>
      </div>
      <div class="score-item">
        <div class="score-item-label">Doa√ß√µes coletadas</div>
        <div class="score-item-value green" id="scoreBoardCollected">0</div>
      </div>
      <div class="score-item">
        <div class="score-item-label">Recorde</div>
        <div class="score-item-value gold" id="scoreBoardBest">0</div>
      </div>
      <div class="score-item">
        <div class="score-item-label">Desconto ganho</div>
        <div class="score-item-value green" id="scoreBoardDiscount">0%</div>
      </div>
    </div>
  </div>
</div>

<!-- PIX MODAL -->
<div class="modal-overlay" id="pixModal">
  <div class="pix-modal" id="pixModalInner">

    <!-- STEP 1: EMAIL -->
    <div id="pixEmailScreen">
      <div class="pix-header">
        <svg class="pix-logo" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M32 4L4 32L32 60L60 32L32 4Z" fill="#32BCAD"/>
          <path d="M20 32L28 24L36 32L28 40L20 32Z" fill="white"/>
          <path d="M28 32L36 24L44 32L36 40L28 32Z" fill="white" opacity="0.6"/>
        </svg>
        <div class="pix-title">Pagar com Pix</div>
      </div>
      <div class="pix-subtitle">Instant√¢neo ‚Ä¢ Sem taxas ‚Ä¢ 100% seguro üîí</div>

      <div class="pix-amount-box">
        <div class="pix-amount-label">Valor da doa√ß√£o</div>
        <div class="pix-amount-value" id="pixAmountValue">R$ 0,00</div>
        <div class="pix-amount-dest" id="pixAmountDest">‚Üí Gatinhos do Rio</div>
      </div>

      <div style="margin: 20px 0;">
        <label style="display:block; font-family:'Fredoka One',cursive; font-size:0.85rem; color:#888; text-transform:uppercase; letter-spacing:1px; margin-bottom:8px; text-align:left;">üìß Seu email (para receber o comprovante)</label>
        <input type="email" id="pixEmailInput" placeholder="seu@email.com" style="width:100%; padding:14px 18px; border-radius:14px; border:2px solid #ddd; font-family:'Baloo 2',cursive; font-size:1rem; outline:none; transition: border-color 0.2s; box-sizing:border-box;" onfocus="this.style.borderColor='#32BCAD'" onblur="this.style.borderColor='#ddd'">
        <div id="pixEmailError" style="color:#e8621a; font-size:0.8rem; margin-top:6px; display:none;">Por favor, insira um email v√°lido</div>
      </div>

      <button class="confirm-pix-btn" onclick="generateRealPix()" id="pixGenerateBtn">üîÑ Gerar QR Code Pix</button>
      <button class="back-pix-btn" onclick="closePixModal()">‚Üê Voltar</button>
    </div>

    <!-- STEP 2: QR CODE -->
    <div id="pixScreen" style="display:none">
      <div class="pix-header">
        <svg class="pix-logo" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M32 4L4 32L32 60L60 32L32 4Z" fill="#32BCAD"/>
          <path d="M20 32L28 24L36 32L28 40L20 32Z" fill="white"/>
          <path d="M28 32L36 24L44 32L36 40L28 32Z" fill="white" opacity="0.6"/>
        </svg>
        <div class="pix-title">Pagar com Pix</div>
      </div>
      <div class="pix-subtitle">Escaneie o QR Code ou copie o c√≥digo Pix</div>

      <div class="pix-amount-box">
        <div class="pix-amount-label">Valor da doa√ß√£o</div>
        <div class="pix-amount-value" id="pixAmountValue2">R$ 0,00</div>
        <div class="pix-amount-dest" id="pixAmountDest2">‚Üí Gatinhos do Rio</div>
      </div>

      <div class="qr-wrapper" id="qrWrapper">
        <img id="pixQrImage" src="" alt="QR Code Pix" style="width:180px; height:180px; border-radius:8px;">
        <div class="qr-cat-overlay">üê±</div>
      </div>

      <div class="pix-timer">
        <div class="timer-circle"></div>
        <span>QR expira em</span>
        <span class="timer-num" id="timerNum">10:00</span>
      </div>

      <div class="pix-key-section">
        <div class="pix-key-label">C√≥digo Pix Copia e Cola</div>
        <div class="pix-key-value" id="pixKeyVal" style="font-size:0.7rem; max-height:60px; overflow-y:auto; word-break:break-all;">Gerando...</div>
        <button class="copy-btn" id="copyBtn" onclick="copyPixKey()">üìã Copiar c√≥digo Pix</button>
      </div>

      <div class="pix-steps">
        <div class="pix-steps-title">Como pagar</div>
        <div class="pix-step-item"><div class="pix-step-num">1</div><span>Abra o app do seu banco</span></div>
        <div class="pix-step-item"><div class="pix-step-num">2</div><span>V√° em <strong>Pix ‚Üí Pagar</strong> e escaneie o QR Code</span></div>
        <div class="pix-step-item"><div class="pix-step-num">3</div><span>Confirme o valor e finalize</span></div>
      </div>

      <div id="pixStatusMsg" style="text-align:center; margin:12px 0; font-family:'Fredoka One',cursive; font-size:0.85rem; color:#32BCAD; display:none;">‚è≥ Verificando pagamento automaticamente...</div>

      <button class="confirm-pix-btn" onclick="confirmPix()">‚úÖ J√° paguei!</button>
      <button class="back-pix-btn" onclick="closePixModal()">‚Üê Voltar</button>
    </div>

    <!-- CONFIRMING SCREEN -->
    <div id="pixConfirmingScreen" style="display:none" class="pix-confirming">
      <span class="pix-confirming-icon">‚ö°</span>
      <div class="pix-confirming-text" id="pixConfirmingText">Confirmando pagamento...</div>
      <div class="pix-confirming-sub" id="pixConfirmingSub">Verificando transa√ß√£o Pix</div>
      <div style="margin-top:20px">
        <div class="timer-circle" style="margin:0 auto; width:48px; height:48px; border-width:4px;"></div>
      </div>
    </div>

    <!-- PIX ERROR SCREEN -->
    <div id="pixErrorScreen" style="display:none; text-align:center; padding:20px 0;">
      <div style="font-size:3rem; margin-bottom:12px;">üòø</div>
      <div style="font-family:'Fredoka One',cursive; font-size:1.2rem; color:#e8621a; margin-bottom:8px;">Ops! Erro ao gerar Pix</div>
      <div id="pixErrorMsg" style="color:#888; font-size:0.85rem; margin-bottom:20px;">Tente novamente em alguns instantes.</div>
      <button class="confirm-pix-btn" onclick="pixGoBackToEmail()" style="background:linear-gradient(135deg,#e8621a,#c44b10);">üîÑ Tentar novamente</button>
      <button class="back-pix-btn" onclick="closePixModal()">‚Üê Voltar</button>
    </div>

  </div>
</div>

<!-- SOLANA MODAL -->
<div class="modal-overlay" id="solModal">
  <div class="sol-modal">

    <div id="solScreen">
      <div class="sol-header">
        <div class="sol-logo-wrap">
          <svg width="32" height="32" viewBox="0 0 397 311" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M64.6 237.9c2.4-2.4 5.7-3.8 9.2-3.8h317.4c5.8 0 8.7 7 4.6 11.1l-62.7 62.7c-2.4 2.4-5.7 3.8-9.2 3.8H6.5c-5.8 0-8.7-7-4.6-11.1l62.7-62.7z" fill="url(#s1)"/>
            <path d="M64.6 3.8C67.1 1.4 70.4 0 73.8 0h317.4c5.8 0 8.7 7 4.6 11.1l-62.7 62.7c-2.4 2.4-5.7 3.8-9.2 3.8H6.5c-5.8 0-8.7-7-4.6-11.1L64.6 3.8z" fill="url(#s2)"/>
            <path d="M333.1 120.1c-2.4-2.4-5.7-3.8-9.2-3.8H6.5c-5.8 0-8.7 7-4.6 11.1l62.7 62.7c2.4 2.4 5.7 3.8 9.2 3.8h317.4c5.8 0 8.7-7 4.6-11.1l-62.7-62.7z" fill="url(#s3)"/>
            <defs>
              <linearGradient id="s1" x1="360" y1="351" x2="146" y2="-67" gradientUnits="userSpaceOnUse"><stop stop-color="#00FFA3"/><stop offset="1" stop-color="#DC1FFF"/></linearGradient>
              <linearGradient id="s2" x1="264" y1="401" x2="50" y2="-17" gradientUnits="userSpaceOnUse"><stop stop-color="#00FFA3"/><stop offset="1" stop-color="#DC1FFF"/></linearGradient>
              <linearGradient id="s3" x1="312" y1="376" x2="98" y2="-42" gradientUnits="userSpaceOnUse"><stop stop-color="#00FFA3"/><stop offset="1" stop-color="#DC1FFF"/></linearGradient>
            </defs>
          </svg>
        </div>
        <div>
          <div class="sol-title">Pagar com Solana</div>
          <div class="sol-subtitle">R√°pido ‚Ä¢ Descentralizado ‚Ä¢ üîê</div>
        </div>
      </div>

      <div class="sol-amount-box">
        <div class="sol-amount-row">
          <div>
            <div class="sol-amount-label">Valor em BRL</div>
            <div class="sol-amount-brl" id="solAmountBrl">R$ 0,00</div>
          </div>
          <div class="sol-equals">‚âà</div>
          <div>
            <div class="sol-amount-label">Valor em SOL</div>
            <div class="sol-amount-sol" id="solAmountSol">
              <span id="solSpinner" class="sol-loading">‚ü≥</span>
              <span id="solValue">...</span> ‚óé
            </div>
          </div>
        </div>
        <div class="sol-rate-note" id="solRateNote">Buscando cota√ß√£o em tempo real...</div>
      </div>

      <div class="sol-qr-wrap">
        <canvas id="solQrCanvas" width="180" height="180"></canvas>
        <div class="sol-qr-cat">‚óé</div>
      </div>

      <div class="sol-address-section">
        <div class="sol-address-label">Endere√ßo da carteira Solana</div>
        <div class="sol-address-value" id="solAddressVal">3D94WEZMX18EMEppaaMXETRGUhBHxAmwaANfghc6SAZZ</div>
        <button class="sol-copy-btn" id="solCopyBtn" onclick="copySolAddress()">üìã Copiar endere√ßo</button>
      </div>

      <div class="sol-network-badge">
        <span class="sol-dot"></span> Rede: <strong>Solana Mainnet</strong> &nbsp;|&nbsp; Token: <strong>SOL nativo</strong>
      </div>

      <div style="margin:12px 0;">
        <label style="display:block;font-size:0.75rem;color:rgba(255,255,255,0.4);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px;text-align:left;">üìß Seu email (para receber comprovante)</label>
        <input type="email" id="solEmailInput" placeholder="seu@email.com" style="width:100%;padding:12px 16px;border-radius:12px;border:2px solid rgba(153,69,255,0.3);background:rgba(255,255,255,0.05);color:white;font-family:'Baloo 2',cursive;font-size:0.95rem;outline:none;box-sizing:border-box;" onfocus="this.style.borderColor='#9945FF'" onblur="this.style.borderColor='rgba(153,69,255,0.3)'">
      </div>

      <div class="pix-steps" style="background:rgba(255,255,255,0.05); border-color:rgba(0,255,163,0.2);">
        <div class="pix-steps-title" style="color:rgba(255,255,255,0.35)">Como enviar SOL</div>
        <div class="pix-step-item" style="color:rgba(255,255,255,0.7)"><div class="pix-step-num" style="background:#9945FF">1</div><span>Abra sua carteira (Phantom, Solflare, etc.)</span></div>
        <div class="pix-step-item" style="color:rgba(255,255,255,0.7)"><div class="pix-step-num" style="background:#9945FF">2</div><span>Escaneie o QR ou cole o endere√ßo acima</span></div>
        <div class="pix-step-item" style="color:rgba(255,255,255,0.7)"><div class="pix-step-num" style="background:#9945FF">3</div><span>Envie exatamente <strong id="solStepAmount" style="color:#00FFA3">... SOL</strong></span></div>
        <div class="pix-step-item" style="color:rgba(255,255,255,0.7)"><div class="pix-step-num" style="background:#9945FF">4</div><span>Clique em <strong>"Confirmar Envio"</strong> abaixo</span></div>
      </div>

      <button class="confirm-sol-btn" id="solPhantomBtn" onclick="payWithPhantom()" style="background:linear-gradient(135deg,#ab9ff2,#9945FF);margin-bottom:8px;">üëª Pagar com Phantom</button>
      <a id="solMobileLink" href="#" target="_blank" class="confirm-sol-btn" style="display:block;text-align:center;text-decoration:none;color:white;background:linear-gradient(135deg,#14F195,#0cbd7a);margin-bottom:8px;font-family:'Fredoka One',cursive;font-size:1rem;padding:14px;border-radius:30px;">üì± Abrir na carteira (mobile)</a>
      <button class="confirm-sol-btn" onclick="confirmSol()">‚úÖ J√° enviei!</button>
      <button class="back-pix-btn" style="border-color:rgba(255,255,255,0.15); color:rgba(255,255,255,0.4);" onclick="closeSolModal()">‚Üê Voltar</button>
    </div>

    <div id="solConfirmingScreen" style="display:none" class="pix-confirming">
      <span class="pix-confirming-icon">üöÄ</span>
      <div class="pix-confirming-text" style="color:#9945FF">Verificando transa√ß√£o...</div>
      <div class="pix-confirming-sub">Aguardando confirma√ß√£o na blockchain</div>
      <div style="margin-top:20px">
        <div class="timer-circle" style="margin:0 auto; width:48px; height:48px; border-width:4px; border-top-color:#9945FF;"></div>
      </div>
    </div>

  </div>
</div>

<!-- LOOT BOX MODAL -->
<div class="modal-overlay" id="raffleModal">
  <div class="lootbox-modal">
    <div class="confetti-container" id="confettiContainer"></div>

    <!-- PHASE 1: TAP THE BOX -->
    <div id="lootPhase1">
      <div class="loot-phase-title">‚ú® loot box felina ‚ú®</div>
      <div class="box-stage">
        <div class="loot-glow-ring"></div>
        <div class="loot-particles" id="lootParticles"></div>
        <span class="loot-box-emoji" id="lootBoxEmoji" onclick="tapBox()">üì¶</span>
      </div>
      <div class="tap-hint" id="tapHint">üëÜ Toque para abrir!</div>
      <div class="loot-taps-bar" id="tapDotsBar">
        <div class="tap-dot" id="dot0"></div>
        <div class="tap-dot" id="dot1"></div>
        <div class="tap-dot" id="dot2"></div>
      </div>
    </div>

    <!-- PHASE 2: EXPLOSION -->
    <div id="lootPhase2">
      <div class="open-explosion">
        <div class="rays" id="raysContainer"></div>
        <span class="open-box-emoji">üéä</span>
        <div class="open-text">CAIXA ABERTA! üêæ</div>
      </div>
    </div>

    <!-- PHASE 3: SLOT ROLL -->
    <div id="lootPhase3">
      <div class="slot-title">üé∞ sorteando seu brinde...</div>
      <div class="slot-machine">
        <div class="slot-highlight"></div>
        <div class="slot-reel">
          <div class="slot-items" id="slotItems"></div>
        </div>
      </div>
    </div>

    <!-- PHASE 4: PRIZE REVEAL -->
    <div id="lootPhase4">
      <div class="prize-rarity-badge" id="rarityBadge">comum</div>
      <span class="prize-big-emoji" id="prizeEmoji">üéÅ</span>
      <div class="prize-big-name" id="prizeName">Brinde</div>
      <div class="prize-big-desc" id="prizeDesc">Parab√©ns!</div>

      <div class="order-summary-modal">
        <div class="order-sum-title">üìã Resumo da Doa√ß√£o</div>
        <div id="modalOrderItems"></div>
        <div class="order-sum-total">
          <span>Total doado:</span>
          <span id="modalTotal">R$ 0,00</span>
        </div>
        <div class="order-sum-shelter" id="modalShelter"></div>
      </div>

      <!-- INSTAGRAM SHARE CARD -->
      <div class="share-section" id="shareSection">
        <div class="share-label">üì∏ Compartilhe sua doa√ß√£o!</div>
        <div class="share-card" id="shareCard">
          <div class="share-card-bg"></div>
          <div class="share-card-inner">
            <div class="share-card-top">
              <span class="share-cat-icon">üê±</span>
              <div class="share-card-brand">Gatinhos do Rio</div>
              <div class="share-card-sub">Doa√ß√£o realizada! üíö</div>
            </div>
            <div class="share-prize-row">
              <span id="sharePrizeEmoji">üéÅ</span>
              <div>
                <div class="share-prize-label" id="shareRarity">Pr√™mio Comum</div>
                <div class="share-prize-name" id="sharePrizeName">Brinde</div>
              </div>
            </div>
            <div class="share-shelter-row" id="shareShelfRow">üè† Abrigo</div>
            <div class="share-footer-row">
              <span>#GatinhosdoRio</span>
              <span>#DoeAmor</span>
              <span>#GatosCariocas</span>
            </div>
          </div>
        </div>
        <div class="share-buttons">
          <button class="share-btn share-ig" onclick="shareInstagram()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="white"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
            Compartilhar no Instagram
          </button>
          <button class="share-btn share-copy" onclick="copyShareText()">
            üìã Copiar texto
          </button>
        </div>
      </div>

      <button class="close-modal-btn" onclick="closeModal()">
        Obrigado! üê±üíö
      </button>
    </div>

  </div>
</div>

<footer>
  <p>Feito com <span>‚ù§Ô∏è</span> no Rio de Janeiro ‚Ä¢ üê± Gatinhos do Rio ¬© 2025</p>
  <p style="margin-top:4px; font-size:0.75rem">Todas as doa√ß√µes s√£o entregues diretamente aos abrigos parceiros</p>
</footer>

<script>
  // State
  const cart = {};
  let selectedShelter = null;

  const prizes = [
    { emoji: 'üñºÔ∏è', name: 'Foto Exclusiva', desc: 'Foto do gatinho adotado enviada por e-mail!', rarity: 'comum' },
    { emoji: 'üìø', name: 'Pulseira Carioca', desc: 'Pulseira artesanal feita por artes√£os do Rio!', rarity: 'comum' },
    { emoji: '‚òï', name: 'Caf√© do Volunt√°rio', desc: 'Voucher para cafezinho no abrigo na pr√≥xima visita!', rarity: 'comum' },
    { emoji: 'üé´', name: 'Visita VIP', desc: 'Agendamento especial para visitar os gatinhos!', rarity: 'raro' },
    { emoji: 'üñåÔ∏è', name: 'Arte Exclusiva', desc: 'Ilustra√ß√£o do seu pet feita por artista carioca!', rarity: 'raro' },
    { emoji: 'üèÖ', name: 'Medalha Padrim', desc: 'Voc√™ vira padrinho oficial de um gatinho do abrigo!', rarity: 'epico' },
    { emoji: 'üåä', name: 'Kit Praia Felina', desc: 'Camiseta + bon√© tem√°tico dos Gatinhos do Rio!', rarity: 'epico' },
    { emoji: 'üß°', name: 'Certificado Her√≥i', desc: 'Certificado de doador her√≥i enviado em casa!', rarity: 'raro' },
    { emoji: 'üê±', name: 'Padrim Lend√°rio!', desc: 'Voc√™ nomeia um gatinho do abrigo + placa com seu nome!', rarity: 'lendario' },
    { emoji: 'üåü', name: 'Kit Carioca Completo', desc: 'Camisa + bon√© + adesivos + caneca dos Gatinhos do Rio!', rarity: 'lendario' },
  ];

  // Weighted random: legendary=5%, epic=15%, rare=30%, common=50%
  function pickPrize() {
    const r = Math.random() * 100;
    let pool;
    if (r < 5) pool = prizes.filter(p => p.rarity === 'lendario');
    else if (r < 20) pool = prizes.filter(p => p.rarity === 'epico');
    else if (r < 50) pool = prizes.filter(p => p.rarity === 'raro');
    else pool = prizes.filter(p => p.rarity === 'comum');
    return pool[Math.floor(Math.random() * pool.length)];
  }

  // LOOT BOX STATE
  let tapCount = 0;
  const MAX_TAPS = 3;
  let chosenPrize = null;

  function tapBox() {
    if (tapCount >= MAX_TAPS) return;
    meow(tapCount === MAX_TAPS - 1 ? 'long' : 'happy');
    tapCount++;

    const box = document.getElementById('lootBoxEmoji');
    box.classList.remove('shaking');
    void box.offsetWidth;
    box.classList.add('shaking');

    // Fill dots
    document.getElementById('dot' + (tapCount - 1)).classList.add('filled');

    // Particle burst
    const particles = ['‚ú®','‚≠ê','üåü','üí´','üêæ','‚ù§Ô∏è','üéâ'];
    const container = document.getElementById('lootParticles');
    for (let i = 0; i < 6; i++) {
      const p = document.createElement('div');
      p.className = 'loot-particle';
      p.textContent = particles[Math.floor(Math.random() * particles.length)];
      const angle = (i / 6) * 360 * Math.PI / 180;
      const dist = 60 + Math.random() * 40;
      p.style.setProperty('--tx', Math.cos(angle) * dist + 'px');
      p.style.setProperty('--ty', Math.sin(angle) * dist - 20 + 'px');
      p.style.animationDelay = (Math.random() * 0.1) + 's';
      container.appendChild(p);
      setTimeout(() => p.remove(), 800);
    }

    // Hint text
    const hints = ['', 'Quase l√°! üî•', 'MAIS UM! üò±'];
    if (tapCount < MAX_TAPS) {
      document.getElementById('tapHint').textContent = hints[tapCount] || 'üëÜ Continue!';
    }

    // Change box emoji per tap
    const boxEmojis = ['üì¶','üì¶','üéÅ'];
    box.textContent = boxEmojis[tapCount - 1] || 'üéÅ';

    if (tapCount >= MAX_TAPS) {
      setTimeout(() => startOpeningPhase(), 400);
    }
  }

  function startOpeningPhase() {
    document.getElementById('lootPhase1').style.display = 'none';
    document.getElementById('lootPhase2').style.display = 'block';

    // Build rays
    const raysContainer = document.getElementById('raysContainer');
    for (let i = 0; i < 12; i++) {
      const ray = document.createElement('div');
      ray.className = 'ray';
      ray.style.setProperty('--angle', (i * 30) + 'deg');
      ray.style.animationDelay = (i * 0.03) + 's';
      raysContainer.appendChild(ray);
    }

    setTimeout(() => {
      document.getElementById('lootPhase2').style.display = 'none';
      startSlotPhase();
    }, 1200);
  }

  function startSlotPhase() {
    document.getElementById('lootPhase3').style.display = 'block';
    chosenPrize = pickPrize();

    // Build slot items list (many shuffled + end on chosen)
    const allEmojis = prizes.map(p => ({ emoji: p.emoji, name: p.name }));
    const slotList = [];
    // 3 full loops of random items
    for (let i = 0; i < 24; i++) {
      slotList.push(allEmojis[Math.floor(Math.random() * allEmojis.length)]);
    }
    // End on the chosen prize
    slotList.push({ emoji: chosenPrize.emoji, name: chosenPrize.name });

    const container = document.getElementById('slotItems');
    container.innerHTML = '';
    slotList.forEach(item => {
      const div = document.createElement('div');
      div.className = 'slot-item';
      div.innerHTML = `<span class="slot-item-emoji">${item.emoji}</span><span class="slot-item-name">${item.name}</span>`;
      container.appendChild(div);
    });

    // Animate scroll
    const itemH = 88;
    const totalItems = slotList.length;
    const targetOffset = -(totalItems - 1) * itemH;

    let current = 0;
    let speed = 30; // ms per step, starts fast
    let step = 0;
    const totalSteps = totalItems - 1;

    function scrollStep() {
      if (step >= totalSteps) {
        // Snap to final
        container.style.transform = `translateY(${targetOffset}px)`;
        setTimeout(() => {
          document.getElementById('lootPhase3').style.display = 'none';
          showRevealPhase();
        }, 400);
        return;
      }

      // Ease out: speed increases as we approach end
      const progress = step / totalSteps;
      const delay = progress < 0.6
        ? 30
        : progress < 0.8
        ? 60
        : progress < 0.9
        ? 120
        : 200;

      current -= itemH;
      container.style.transform = `translateY(${current}px)`;
      step++;
      setTimeout(scrollStep, delay);
    }

    setTimeout(scrollStep, 100);
  }

  function fanfare(rarity) {
    try {
      const ctx = getAudioCtx();
      if (ctx.state === 'suspended') ctx.resume();
      const now = ctx.currentTime;

      const notes = {
        comum:    [523, 659, 784],           // C E G  ‚Äî simple chord
        raro:     [523, 659, 784, 1047],     // C E G C8
        epico:    [392, 523, 659, 784, 1047],// G C E G C
        lendario: [262, 330, 392, 523, 659, 784, 1047, 1319] // full arpeggio
      };

      const melody = notes[rarity] || notes.comum;

      melody.forEach((freq, i) => {
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        const delay = i * (rarity === 'lendario' ? 0.1 : 0.12);

        osc.connect(gain);
        gain.connect(ctx.destination);

        osc.type = i % 2 === 0 ? 'sine' : 'triangle';
        osc.frequency.setValueAtTime(freq, now + delay);

        gain.gain.setValueAtTime(0, now + delay);
        gain.gain.linearRampToValueAtTime(0.15, now + delay + 0.04);
        gain.gain.exponentialRampToValueAtTime(0.001, now + delay + 0.5);

        osc.start(now + delay);
        osc.stop(now + delay + 0.6);
      });

      // Add a little jingle bell at the end for legendary
      if (rarity === 'lendario') {
        [1319, 1047, 1319].forEach((freq, i) => {
          const osc = ctx.createOscillator();
          const gain = ctx.createGain();
          const delay = melody.length * 0.1 + i * 0.08;
          osc.connect(gain);
          gain.connect(ctx.destination);
          osc.type = 'sine';
          osc.frequency.value = freq;
          gain.gain.setValueAtTime(0, now + delay);
          gain.gain.linearRampToValueAtTime(0.18, now + delay + 0.03);
          gain.gain.exponentialRampToValueAtTime(0.001, now + delay + 0.35);
          osc.start(now + delay);
          osc.stop(now + delay + 0.4);
        });
      }
    } catch(e) {}
  }

  function showRevealPhase() {
    document.getElementById('lootPhase4').style.display = 'block';

    const rarityLabels = { comum: '‚ö™ Comum', raro: 'üîµ Raro', epico: 'üíú √âpico', lendario: 'üåü Lend√°rio' };
    const badge = document.getElementById('rarityBadge');
    badge.textContent = rarityLabels[chosenPrize.rarity] || chosenPrize.rarity;
    badge.className = 'prize-rarity-badge rarity-' + chosenPrize.rarity;

    document.getElementById('prizeEmoji').textContent = chosenPrize.emoji;
    document.getElementById('prizeName').textContent = chosenPrize.name;
    document.getElementById('prizeDesc').textContent = chosenPrize.desc;

    // Order summary
    const keys = Object.keys(cart);
    let totalVal = 0;
    let itemsHtml = '';
    keys.forEach(k => {
      const item = cart[k];
      const sub = item.qty * item.price;
      totalVal += sub;
      itemsHtml += `<div class="order-sum-item"><span>${item.emoji} ${item.name} x${item.qty}</span><span>R$ ${sub.toFixed(2).replace('.',',')}</span></div>`;
    });
    document.getElementById('modalOrderItems').innerHTML = itemsHtml;
    document.getElementById('modalTotal').textContent = `R$ ${totalVal.toFixed(2).replace('.',',')}`;
    document.getElementById('modalShelter').textContent = `üè† Destinado ao abrigo: ${selectedShelter}`;

    // Populate share card
    document.getElementById('sharePrizeEmoji').textContent = chosenPrize.emoji;
    document.getElementById('shareRarity').textContent = rarityLabels[chosenPrize.rarity];
    document.getElementById('sharePrizeName').textContent = chosenPrize.name;
    document.getElementById('shareShelfRow').textContent = `üè† Doei para: ${selectedShelter}`;

    generateConfetti(chosenPrize.rarity);

    // Play purchase fanfare!
    setTimeout(() => fanfare(chosenPrize.rarity), 200);

    if (chosenPrize.rarity === 'lendario') {
      setTimeout(() => meow('epic'), 500);
      setTimeout(() => meow('epic'), 1100);
    }
  }

  function selectShelter(card, name) {
    document.querySelectorAll('.shelter-card').forEach(c => c.classList.remove('selected'));
    card.classList.add('selected');
    selectedShelter = name;
    document.getElementById('shelterSelectedMsg').textContent = `‚úÖ Abrigo selecionado: ${name}`;
    document.getElementById('shelterSelectedMsg').style.color = '#1a7a4a';
    updateDonateBtn();
    sparkleEffect(card);
  }

  function addItem(card) {
    const name = card.dataset.name;
    const price = parseFloat(card.dataset.price);
    const emoji = card.dataset.emoji;

    if (!cart[name]) {
      cart[name] = { name, price, emoji, qty: 1 };
      card.classList.add('in-cart');
      const qtyDiv = card.querySelector('.item-qty');
      if (qtyDiv) qtyDiv.style.display = 'flex';
    } else {
      cart[name].qty++;
      const qtyEl = card.querySelector('.qty-num');
      if (qtyEl) qtyEl.textContent = cart[name].qty;
    }

    updateCart();
    bounceCartCount();
    sparkleEffect(card);
  }

  function changeQty(e, delta, btn) {
    e.stopPropagation();
    const card = btn.closest('.item-card');
    const name = card.dataset.name;
    if (!cart[name]) return;
    cart[name].qty += delta;
    if (cart[name].qty <= 0) {
      delete cart[name];
      card.classList.remove('in-cart');
      const qtyDiv = card.querySelector('.item-qty');
      if (qtyDiv) qtyDiv.style.display = 'none';
      const qtyEl = card.querySelector('.qty-num');
      if (qtyEl) qtyEl.textContent = 1;
    } else {
      const qtyEl = card.querySelector('.qty-num');
      if (qtyEl) qtyEl.textContent = cart[name].qty;
    }
    updateCart();
  }

  function updateCart() {
    const content = document.getElementById('cartContent');
    const keys = Object.keys(cart);

    if (keys.length === 0) {
      content.innerHTML = '<div class="cart-empty"><span>üê±</span>Nenhum item ainda... Escolha algo na prateleira!</div>';
      document.getElementById('progressSection').style.display = 'none';
    } else {
      let html = '<ul class="cart-items-list">';
      let total = 0;
      keys.forEach(k => {
        const item = cart[k];
        const sub = item.qty * item.price;
        total += sub;
        html += `<li class="cart-item">
          <span class="cart-item-emoji">${item.emoji}</span>
          <div class="cart-item-info">
            <div class="cart-item-name">${item.name}</div>
            <div class="cart-item-sub">x${item.qty} ‚Ä¢ R$ ${item.price.toFixed(2).replace('.',',')} cada</div>
          </div>
          <span class="cart-item-price">R$ ${sub.toFixed(2).replace('.',',')}</span>
          <button class="remove-btn" onclick="removeItem('${k}')">‚úï</button>
        </li>`;
      });
      html += `</ul><div class="cart-total"><span class="cart-total-label">Total</span><span class="cart-total-price">R$ ${total.toFixed(2).replace('.',',')}</span></div>`;
      content.innerHTML = html;

      // Progress
      const prog = Math.min(keys.length / 3, 1);
      document.getElementById('progressSection').style.display = 'block';
      document.getElementById('progressBar').style.width = (prog * 100) + '%';
      document.getElementById('progressPct').textContent = Math.round(prog * 100) + '%';
      if (keys.length >= 3) {
        document.getElementById('progressText').textContent = 'üéâ Raffle desbloqueado!';
        document.getElementById('progressText').style.color = '#1a7a4a';
      } else {
        document.getElementById('progressText').textContent = `${keys.length} de 3 itens para desbloquear raffle!`;
        document.getElementById('progressText').style.color = '';
      }
    }

    // Update count badge
    const total2 = keys.reduce((sum, k) => sum + cart[k].qty, 0);
    document.getElementById('cartCount').textContent = total2;
    updateDonateBtn();
  }

  function removeItem(name) {
    const card = document.querySelector(`[data-name="${name}"]`);
    if (card) {
      card.classList.remove('in-cart');
      const qtyDiv = card.querySelector('.item-qty');
      if (qtyDiv) qtyDiv.style.display = 'none';
      const qtyEl = card.querySelector('.qty-num');
      if (qtyEl) qtyEl.textContent = 1;
    }
    delete cart[name];
    updateCart();
  }

  function updateDonateBtn() {
    const btn = document.getElementById('donateBtn');
    const warn = document.getElementById('warningMsg');
    const hasItems = Object.keys(cart).length > 0;
    const hasShelter = !!selectedShelter;

    if (hasItems && hasShelter) {
      btn.disabled = false;
      warn.textContent = Object.keys(cart).length >= 3
        ? 'üéâ Raffle desbloqueado! Finalize para girar!'
        : '‚úÖ Tudo pronto para finalizar!';
      warn.style.color = '#1a7a4a';
    } else {
      btn.disabled = true;
      if (!hasShelter && !hasItems) warn.textContent = 'Adicione pelo menos 1 item e selecione um abrigo';
      else if (!hasShelter) warn.textContent = 'Selecione um abrigo para continuar';
      else warn.textContent = 'Adicione pelo menos 1 item √† cesta';
      warn.style.color = '';
    }
  }

  function bounceCartCount() {
    const el = document.getElementById('cartCount');
    el.classList.remove('bounce');
    void el.offsetWidth;
    el.classList.add('bounce');
  }

  function sparkleEffect(element) {
    const rect = element.getBoundingClientRect();
    const stars = ['‚≠ê','‚ú®','üåü','üí´','üê±'];
    for (let i = 0; i < 3; i++) {
      const star = document.createElement('div');
      star.className = 'star';
      star.textContent = stars[Math.floor(Math.random() * stars.length)];
      star.style.left = (rect.left + Math.random() * rect.width) + 'px';
      star.style.top = (rect.top + window.scrollY + Math.random() * rect.height) + 'px';
      star.style.animationDelay = (Math.random() * 0.3) + 's';
      document.body.appendChild(star);
      setTimeout(() => star.remove(), 1600);
    }
  }

  function donate() {
    // Reset loot box state
    tapCount = 0;
    chosenPrize = null;
    document.getElementById('lootPhase1').style.display = 'block';
    document.getElementById('lootPhase2').style.display = 'none';
    document.getElementById('lootPhase3').style.display = 'none';
    document.getElementById('lootPhase4').style.display = 'none';
    document.getElementById('lootBoxEmoji').textContent = 'üì¶';
    document.getElementById('tapHint').textContent = 'üëÜ Toque para abrir!';
    document.getElementById('lootParticles').innerHTML = '';
    document.getElementById('raysContainer').innerHTML = '';
    document.getElementById('slotItems').innerHTML = '';
    ['dot0','dot1','dot2'].forEach(id => document.getElementById(id).classList.remove('filled'));

    const modal = document.getElementById('raffleModal');
    modal.classList.add('active');
  }

  function generateConfetti(rarity) {
    const container = document.getElementById('confettiContainer');
    container.innerHTML = '';
    const colorsByRarity = {
      comum: ['#aaa','#ccc','#eee','#fff'],
      raro: ['#1e4fa8','#4a90d9','#fff','#a8d0ff'],
      epico: ['#7b2ff7','#c84bff','#ff80ff','#fff'],
      lendario: ['#f5c518','#e8621a','#fff','#ffe066','#ff6600']
    };
    const colors = colorsByRarity[rarity] || colorsByRarity.comum;
    const count = rarity === 'lendario' ? 80 : rarity === 'epico' ? 60 : 40;
    for (let i = 0; i < count; i++) {
      const c = document.createElement('div');
      c.className = 'confetti-piece';
      c.style.cssText = `
        left: ${Math.random() * 100}%;
        background: ${colors[Math.floor(Math.random() * colors.length)]};
        width: ${Math.random() * 10 + 4}px;
        height: ${Math.random() * 14 + 6}px;
        border-radius: ${Math.random() > 0.5 ? '50%' : '2px'};
        animation-duration: ${Math.random() * 2.5 + 1.5}s;
        animation-delay: ${Math.random() * 0.8}s;
        transform: rotate(${Math.random() * 360}deg);
      `;
      container.appendChild(c);
    }
  }

  function closeModal() {
    document.getElementById('raffleModal').classList.remove('active');
    // Reset cart
    Object.keys(cart).forEach(k => { delete cart[k]; });
    document.querySelectorAll('.item-card').forEach(c => {
      c.classList.remove('in-cart');
      const qtyDiv = c.querySelector('.item-qty');
      if (qtyDiv) qtyDiv.style.display = 'none';
      const qtyEl = c.querySelector('.qty-num');
      if (qtyEl) qtyEl.textContent = 1;
    });
    document.querySelectorAll('.shelter-card').forEach(c => c.classList.remove('selected'));
    selectedShelter = null;
    document.getElementById('shelterSelectedMsg').textContent = 'Selecione um abrigo acima antes de finalizar';
    document.getElementById('shelterSelectedMsg').style.color = '';
    updateCart();
  }

  // ---- MEOW SOUND ENGINE (Web Audio API, no files needed) ----
  let audioCtx = null;

  function getAudioCtx() {
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    return audioCtx;
  }

  function meow(type = 'normal') {
    try {
      const ctx = getAudioCtx();
      if (ctx.state === 'suspended') ctx.resume();

      const now = ctx.currentTime;

      // Oscillator for the meow tone
      const osc = ctx.createOscillator();
      const gainNode = ctx.createGain();
      const filter = ctx.createBiquadFilter();

      osc.connect(filter);
      filter.connect(gainNode);
      gainNode.connect(ctx.destination);

      filter.type = 'bandpass';
      filter.frequency.value = 900;
      filter.Q.value = 2;

      // Different meow shapes
      const configs = {
        normal: { start: 600, peak: 1100, end: 500, dur: 0.35 },
        happy:  { start: 800, peak: 1400, end: 700, dur: 0.25 },
        long:   { start: 500, peak: 1200, end: 400, dur: 0.55 },
        tiny:   { start: 900, peak: 1500, end: 800, dur: 0.18 },
        epic:   { start: 400, peak: 900,  end: 300, dur: 0.7  },
      };
      const c = configs[type] || configs.normal;

      osc.type = 'sawtooth';
      osc.frequency.setValueAtTime(c.start, now);
      osc.frequency.linearRampToValueAtTime(c.peak, now + c.dur * 0.3);
      osc.frequency.linearRampToValueAtTime(c.end, now + c.dur);

      gainNode.gain.setValueAtTime(0, now);
      gainNode.gain.linearRampToValueAtTime(0.12, now + 0.04);
      gainNode.gain.linearRampToValueAtTime(0.1, now + c.dur * 0.6);
      gainNode.gain.linearRampToValueAtTime(0, now + c.dur);

      osc.start(now);
      osc.stop(now + c.dur + 0.05);
    } catch(e) {}
  }

  // Meow varieties to cycle through
  const meowTypes = ['normal', 'happy', 'tiny', 'normal', 'happy', 'tiny', 'long'];
  let meowIndex = 0;
  function nextMeow() {
    meow(meowTypes[meowIndex % meowTypes.length]);
    meowIndex++;
  }

  // Attach meow to ALL interactive elements via event delegation
  document.addEventListener('click', function(e) {
    const target = e.target;
    const isInteractive = target.closest('button, .item-card, .shelter-card, .cart-btn, .donate-btn, .copy-btn, .confirm-pix-btn, .back-pix-btn, .close-modal-btn, .loot-box-emoji, .close-pix-btn');
    if (isInteractive) nextMeow();
  }, true);

  function showPaymentSelector() {
    const sel = document.getElementById('paymentSelector');
    const btn = document.getElementById('donateBtn');
    if (sel.style.display === 'none' || sel.style.display === '') {
      sel.style.display = 'block';
      btn.textContent = '‚úï Cancelar';
      btn.style.background = 'linear-gradient(135deg,#888,#666)';
      btn.style.boxShadow = '0 4px 0 #444';
      btn.onclick = hidePaymentSelector;
    } else {
      hidePaymentSelector();
    }
  }

  function hidePaymentSelector() {
    document.getElementById('paymentSelector').style.display = 'none';
    const btn = document.getElementById('donateBtn');
    btn.textContent = 'üêæ Finalizar Doa√ß√£o';
    btn.style.background = '';
    btn.style.boxShadow = '';
    btn.onclick = showPaymentSelector;
  }

  // ---- MERCADO PAGO (Link de Pagamento) ----
  // ‚ö†Ô∏è SUBSTITUA O LINK ABAIXO PELO SEU LINK DE PAGAMENTO DO MERCADO PAGO
  // Para criar: Mercado Pago ‚Üí Seu neg√≥cio ‚Üí Cobran√ßas ‚Üí Link de pagamento
  const MERCADO_PAGO_LINK = 'https://link.mercadopago.com.br/gatinhosdorio';
  // Exemplo: const MERCADO_PAGO_LINK = 'https://mpago.la/2X3abc';

  function openMercadoPago() {
    hidePaymentSelector();
    const total = getCartTotal();

    if (MERCADO_PAGO_LINK === 'SEU_LINK_AQUI') {
      // Alerta se ainda n√£o configurou o link
      const modal = document.createElement('div');
      modal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.85);display:flex;align-items:center;justify-content:center;z-index:9999;';
      modal.innerHTML = `
        <div style="background:#1a1a2e;border-radius:24px;padding:32px;max-width:420px;width:90%;text-align:center;border:2px solid rgba(0,158,227,0.3);">
          <div style="font-size:3rem;margin-bottom:12px;">‚öôÔ∏è</div>
          <div style="font-family:'Fredoka One',cursive;font-size:1.3rem;color:#009ee3;margin-bottom:8px;">Configurar Mercado Pago</div>
          <div style="color:rgba(255,255,255,0.7);font-size:0.9rem;line-height:1.6;margin-bottom:20px;">
            Para ativar pagamentos reais, voc√™ precisa:<br><br>
            <strong style="color:#fff;">1.</strong> Acesse <strong style="color:#009ee3;">mercadopago.com.br</strong><br>
            <strong style="color:#fff;">2.</strong> V√° em <strong style="color:#009ee3;">Seu neg√≥cio ‚Üí Cobran√ßas</strong><br>
            <strong style="color:#fff;">3.</strong> Crie um <strong style="color:#009ee3;">Link de pagamento</strong><br>
            <strong style="color:#fff;">4.</strong> Cole o link no c√≥digo onde diz:<br>
            <code style="background:rgba(255,255,255,0.1);padding:4px 8px;border-radius:6px;font-size:0.8rem;color:#009ee3;display:inline-block;margin-top:4px;">MERCADO_PAGO_LINK = 'seu_link'</code>
          </div>
          <div style="color:rgba(255,255,255,0.4);font-size:0.75rem;margin-bottom:16px;">
            üí° O Mercado Pago j√° envia emails de confirma√ß√£o autom√°ticos para voc√™ e para quem paga!
          </div>
          <button onclick="this.closest('div[style]').parentElement.remove()" style="background:#009ee3;color:white;border:none;padding:12px 32px;font-family:'Fredoka One',cursive;font-size:1rem;border-radius:30px;cursor:pointer;box-shadow:0 4px 0 #005a8c;">
            Entendi! üëç
          </button>
        </div>
      `;
      document.body.appendChild(modal);
      modal.addEventListener('click', (e) => { if (e.target === modal) modal.remove(); });
      return;
    }

    // Salva dados da doa√ß√£o no sessionStorage antes de redirecionar
    try {
      sessionStorage.setItem('gatinhos_donation', JSON.stringify({
        items: Object.values(cart).map(i => ({ name: i.name, qty: i.qty, price: i.price })),
        total: total,
        shelter: selectedShelter,
        date: new Date().toISOString()
      }));
    } catch(e) {}

    // Redireciona para o Mercado Pago com valor preenchido
    window.open(MERCADO_PAGO_LINK + '?amount=' + total.toFixed(2), '_blank');

    // Mostra modal de confirma√ß√£o ap√≥s redirecionar
    setTimeout(() => {
      showMPConfirmModal(total);
    }, 500);
  }

  function showMPConfirmModal(total) {
    const modal = document.createElement('div');
    modal.id = 'mpConfirmModal';
    modal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.85);display:flex;align-items:center;justify-content:center;z-index:9999;';
    modal.innerHTML = `
      <div style="background:#1a1a2e;border-radius:24px;padding:32px;max-width:420px;width:90%;text-align:center;border:2px solid rgba(0,158,227,0.3);">
        <div style="font-size:3rem;margin-bottom:12px;">üíô</div>
        <div style="font-family:'Fredoka One',cursive;font-size:1.3rem;color:#009ee3;margin-bottom:8px;">Pagamento aberto!</div>
        <div style="color:rgba(255,255,255,0.7);font-size:0.9rem;line-height:1.6;margin-bottom:8px;">
          Complete o pagamento de <strong style="color:#009ee3;">R$ ${total.toFixed(2).replace('.',',')}</strong> na aba do Mercado Pago.
        </div>
        <div style="color:rgba(255,255,255,0.5);font-size:0.78rem;margin-bottom:20px;">
          üìß Ap√≥s o pagamento, voc√™ e n√≥s receberemos um email de confirma√ß√£o automaticamente pelo Mercado Pago!
        </div>
        <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap;">
          <button onclick="mpConfirmDone()" style="background:#009ee3;color:white;border:none;padding:12px 28px;font-family:'Fredoka One',cursive;font-size:1rem;border-radius:30px;cursor:pointer;box-shadow:0 4px 0 #005a8c;">
            ‚úÖ J√° paguei!
          </button>
          <button onclick="document.getElementById('mpConfirmModal').remove()" style="background:none;border:2px solid rgba(255,255,255,0.2);color:rgba(255,255,255,0.6);padding:12px 28px;font-family:'Fredoka One',cursive;font-size:1rem;border-radius:30px;cursor:pointer;">
            Cancelar
          </button>
        </div>
      </div>
    `;
    document.body.appendChild(modal);
    modal.addEventListener('click', (e) => { if (e.target === modal) modal.remove(); });
  }

  function mpConfirmDone() {
    const modal = document.getElementById('mpConfirmModal');
    if (modal) modal.remove();
    sendDonationEmail();
    donate();
  }

  // ---- ENVIO DE EMAIL PERSONALIZADO ----
  function sendDonationEmail() {
    var emailInput = document.getElementById('pixEmailInput');
    var email = emailInput ? emailInput.value.trim() : '';

    // Se n√£o tem email do pix, tenta pegar do campo Solana
    if (!email) {
      var solEmailInput = document.getElementById('solEmailInput');
      email = solEmailInput ? solEmailInput.value.trim() : '';
    }

    if (!email) return;

    var items = Object.values(cart).map(function(i) {
      return { name: i.name, qty: i.qty, price: i.price, emoji: i.emoji };
    });
    var total = getCartTotal();

    fetch('/api/email', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        email: email,
        items: items,
        total: total,
        shelter: selectedShelter || 'Abrigo',
        prize: chosenPrize ? { emoji: chosenPrize.emoji, name: chosenPrize.name, rarity: chosenPrize.rarity } : null
      })
    }).catch(function(e) { console.log('Email n√£o enviado:', e); });
  }

  // ---- SOLANA ----
  let solPrice = null;

  async function fetchSolPrice() {
    try {
      const r = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=solana&vs_currencies=brl', { signal: AbortSignal.timeout(5000) });
      const d = await r.json();
      solPrice = d?.solana?.brl || null;
    } catch(e) {
      solPrice = null;
    }
  }

  const SOL_WALLET = '3D94WEZMX18EMEppaaMXETRGUhBHxAmwaANfghc6SAZZ';

  function openSolModal() {
    hidePaymentSelector();
    const total = getCartTotal();
    document.getElementById('solAmountBrl').textContent = `R$ ${total.toFixed(2).replace('.',',')}`;

    // Show spinner, fetch price
    document.getElementById('solValue').textContent = '...';
    document.getElementById('solSpinner').style.display = 'inline-block';
    document.getElementById('solRateNote').textContent = 'Buscando cota√ß√£o em tempo real...';
    document.getElementById('solStepAmount').textContent = '... SOL';
    document.getElementById('solAddressVal').textContent = SOL_WALLET;

    // Draw QR with wallet address
    drawSolQR(SOL_WALLET + '?amount=' + total.toFixed(2));

    document.getElementById('solScreen').style.display = 'block';
    document.getElementById('solConfirmingScreen').style.display = 'none';
    document.getElementById('solModal').classList.add('active');

    // Esconde/mostra bot√£o Phantom dependendo se tem carteira
    var phantomBtn = document.getElementById('solPhantomBtn');
    if (phantomBtn) {
      phantomBtn.style.display = (window.solana && window.solana.isPhantom) ? 'block' : 'none';
    }

    fetchSolPrice().then(() => {
      if (solPrice) {
        const solAmt = (total / solPrice).toFixed(4);
        document.getElementById('solValue').textContent = solAmt;
        document.getElementById('solSpinner').style.display = 'none';
        document.getElementById('solRateNote').textContent = `1 SOL ‚âà R$ ${solPrice.toFixed(2).replace('.',',')} ‚Ä¢ CoinGecko`;
        document.getElementById('solStepAmount').textContent = `${solAmt} SOL`;
        // Redraw QR with proper solana: URI
        var solUri = `solana:${SOL_WALLET}?amount=${solAmt}`;
        drawSolQR(solUri);
        // Atualiza link mobile
        var mobileLink = document.getElementById('solMobileLink');
        if (mobileLink) mobileLink.href = solUri;
      } else {
        document.getElementById('solValue').textContent = '?';
        document.getElementById('solSpinner').style.display = 'none';
        document.getElementById('solRateNote').textContent = 'Cota√ß√£o indispon√≠vel ‚Äî use o endere√ßo da carteira';
        document.getElementById('solStepAmount').textContent = '(confira valor na sua carteira)';
      }
    });
  }

  async function payWithPhantom() {
    try {
      if (!window.solana || !window.solana.isPhantom) {
        window.open('https://phantom.app/', '_blank');
        return;
      }

      var phantomBtn = document.getElementById('solPhantomBtn');
      if (phantomBtn) { phantomBtn.disabled = true; phantomBtn.textContent = '‚è≥ Conectando carteira...'; }

      // Conecta √† carteira
      const resp = await window.solana.connect();
      const senderPubkey = resp.publicKey;

      const total = getCartTotal();
      const solAmt = solPrice ? (total / solPrice) : 0;

      if (solAmt <= 0) {
        throw new Error('Cota√ß√£o indispon√≠vel. Use o QR Code ou link mobile.');
      }

      const lamports = Math.round(solAmt * 1000000000); // 1 SOL = 1 bilh√£o de lamports

      if (phantomBtn) phantomBtn.textContent = '‚è≥ Confirme na carteira...';

      // Usa o m√©todo signAndSendTransaction do Phantom com a transa√ß√£o serializada
      // O Phantom cuida do RPC internamente
      const { Connection, PublicKey, Transaction, SystemProgram } = await import('https://esm.sh/@solana/web3.js@1.87.6');

      // Usa o RPC do Phantom via provider
      const connection = new Connection('https://rpc.ankr.com/solana', 'confirmed');

      const recipientPubkey = new PublicKey(SOL_WALLET);

      const transaction = new Transaction().add(
        SystemProgram.transfer({
          fromPubkey: senderPubkey,
          toPubkey: recipientPubkey,
          lamports: lamports
        })
      );

      const { blockhash } = await connection.getLatestBlockhash();
      transaction.recentBlockhash = blockhash;
      transaction.feePayer = senderPubkey;

      const signed = await window.solana.signAndSendTransaction(transaction);

      if (phantomBtn) phantomBtn.textContent = '‚è≥ Aguardando confirma√ß√£o...';

      await connection.confirmTransaction(signed.signature, 'confirmed');

      // SUCESSO!
      document.getElementById('solScreen').style.display = 'none';
      document.getElementById('solConfirmingScreen').style.display = 'block';

      var solConfText = document.querySelector('#solConfirmingScreen .pix-confirming-text');
      if (solConfText) { solConfText.textContent = '‚úÖ Transa√ß√£o confirmada!'; solConfText.style.color = '#00FFA3'; }
      var solConfSub = document.querySelector('#solConfirmingScreen .pix-confirming-sub');
      if (solConfSub) solConfSub.textContent = 'TX: ' + signed.signature.slice(0, 12) + '...';

      sendDonationEmail();

      setTimeout(function() {
        document.getElementById('solModal').classList.remove('active');
        setTimeout(function() {
          document.getElementById('solScreen').style.display = 'block';
          document.getElementById('solConfirmingScreen').style.display = 'none';
        }, 400);
        donate();
      }, 2400);

    } catch (error) {
      console.error('Erro Solana:', error);
      var phantomBtn2 = document.getElementById('solPhantomBtn');
      if (phantomBtn2) { phantomBtn2.disabled = false; phantomBtn2.textContent = 'üëª Pagar com Phantom'; }

      if (error.message && (error.message.includes('User rejected') || error.message.includes('cancelled'))) {
        // Usu√°rio cancelou, n√£o faz nada
      } else {
        alert('Erro: ' + (error.message || 'Falha na transa√ß√£o. Tente pelo QR Code ou link mobile.'));
      }
    }
  }

  function drawSolQR(text) {
    const canvas = document.getElementById('solQrCanvas');
    drawQRCodeOn(canvas, text, '#9945FF');
  }

  function drawQRCodeOn(canvas, text, accentColor) {
    const ctx = canvas.getContext('2d');
    const size = 180;
    canvas.width = size;
    canvas.height = size;

    ctx.fillStyle = 'white';
    ctx.fillRect(0, 0, size, size);

    const modules = 25;
    const cellSize = size / modules;

    let seed = 0;
    for (let i = 0; i < text.length; i++) seed = (seed * 31 + text.charCodeAt(i)) >>> 0;
    function rand() { seed = (seed * 1664525 + 1013904223) >>> 0; return seed / 4294967296; }

    ctx.fillStyle = '#111';
    for (let r = 0; r < modules; r++) {
      for (let c = 0; c < modules; c++) {
        const inFinder = (r < 8 && c < 8) || (r < 8 && c >= modules-8) || (r >= modules-8 && c < 8);
        if (!inFinder && rand() > 0.55) {
          ctx.fillRect(c * cellSize, r * cellSize, cellSize - 0.5, cellSize - 0.5);
        }
      }
    }

    [[0,0],[0,modules-7],[modules-7,0]].forEach(([row,col]) => {
      ctx.fillStyle = accentColor || '#111';
      ctx.fillRect(col*cellSize, row*cellSize, 7*cellSize, 7*cellSize);
      ctx.fillStyle = 'white';
      ctx.fillRect((col+1)*cellSize, (row+1)*cellSize, 5*cellSize, 5*cellSize);
      ctx.fillStyle = accentColor || '#111';
      ctx.fillRect((col+2)*cellSize, (row+2)*cellSize, 3*cellSize, 3*cellSize);
    });

    ctx.fillStyle = '#111';
    for (let i = 8; i < modules - 8; i++) {
      if (i % 2 === 0) {
        ctx.fillRect(i*cellSize, 6*cellSize, cellSize-0.5, cellSize-0.5);
        ctx.fillRect(6*cellSize, i*cellSize, cellSize-0.5, cellSize-0.5);
      }
    }
  }

  function copySolAddress() {
    navigator.clipboard.writeText(SOL_WALLET).catch(() => {});
    const btn = document.getElementById('solCopyBtn');
    btn.textContent = '‚úÖ Copiado!';
    btn.classList.add('copied');
    setTimeout(() => { btn.textContent = 'üìã Copiar endere√ßo'; btn.classList.remove('copied'); }, 2500);
  }

  function confirmSol() {
    // Mostra campo pra colar o hash da transa√ß√£o
    var existingPrompt = document.getElementById('solTxPrompt');
    if (existingPrompt) existingPrompt.remove();

    var prompt = document.createElement('div');
    prompt.id = 'solTxPrompt';
    prompt.style.cssText = 'background:rgba(0,0,0,0.3);border:2px solid rgba(153,69,255,0.4);border-radius:14px;padding:16px;margin:12px 0;';
    prompt.innerHTML = '<label style="display:block;font-size:0.75rem;color:rgba(255,255,255,0.5);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Cole o hash (signature) da transa√ß√£o:</label>' +
      '<input type="text" id="solTxHashInput" placeholder="Ex: 5UfDuX..." style="width:100%;padding:12px 14px;border-radius:10px;border:2px solid rgba(153,69,255,0.3);background:rgba(255,255,255,0.05);color:white;font-family:monospace;font-size:0.85rem;outline:none;box-sizing:border-box;" onfocus="this.style.borderColor=\'#9945FF\'" onblur="this.style.borderColor=\'rgba(153,69,255,0.3)\'">' +
      '<div id="solTxError" style="color:#e8621a;font-size:0.78rem;margin-top:6px;display:none;"></div>' +
      '<button onclick="verifySolTransaction()" id="solVerifyBtn" style="margin-top:10px;width:100%;padding:12px;border:none;border-radius:30px;background:linear-gradient(135deg,#9945FF,#7b2ff2);color:white;font-family:\'Fredoka One\',cursive;font-size:0.95rem;cursor:pointer;">üîç Verificar transa√ß√£o</button>';

    var confirmBtn = document.querySelector('#solScreen .confirm-sol-btn:last-of-type');
    if (confirmBtn) confirmBtn.parentNode.insertBefore(prompt, confirmBtn);
  }

  async function verifySolTransaction() {
    var hashInput = document.getElementById('solTxHashInput');
    var txHash = hashInput ? hashInput.value.trim() : '';
    var errorEl = document.getElementById('solTxError');
    var verifyBtn = document.getElementById('solVerifyBtn');

    if (!txHash || txHash.length < 30) {
      if (errorEl) { errorEl.textContent = 'Cole o hash completo da transa√ß√£o.'; errorEl.style.display = 'block'; }
      return;
    }

    if (verifyBtn) { verifyBtn.disabled = true; verifyBtn.textContent = '‚è≥ Verificando na blockchain...'; }
    if (errorEl) errorEl.style.display = 'none';

    try {
      // Verifica a transa√ß√£o na API p√∫blica da Solana
      var response = await fetch('https://rpc.ankr.com/solana', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          jsonrpc: '2.0',
          id: 1,
          method: 'getTransaction',
          params: [txHash, { encoding: 'jsonParsed', maxSupportedTransactionVersion: 0 }]
        })
      });

      var data = await response.json();

      if (!data.result) {
        // Transa√ß√£o n√£o encontrada ‚Äî pode estar pendente, tenta de novo
        if (errorEl) {
          errorEl.textContent = 'Transa√ß√£o n√£o encontrada. Se acabou de enviar, aguarde ~30 segundos e tente novamente.';
          errorEl.style.display = 'block';
        }
        if (verifyBtn) { verifyBtn.disabled = false; verifyBtn.textContent = 'üîç Verificar transa√ß√£o'; }
        return;
      }

      // Verifica se a transa√ß√£o n√£o deu erro
      if (data.result.meta && data.result.meta.err) {
        if (errorEl) { errorEl.textContent = 'Transa√ß√£o encontrada mas falhou. Verifique o hash.'; errorEl.style.display = 'block'; }
        if (verifyBtn) { verifyBtn.disabled = false; verifyBtn.textContent = 'üîç Verificar transa√ß√£o'; }
        return;
      }

      // Verifica se o destino √© a carteira correta E se o valor est√° correto
      var instructions = data.result.transaction?.message?.instructions || [];
      var isToUs = false;
      var receivedLamports = 0;
      instructions.forEach(function(ix) {
        if (ix.parsed && ix.parsed.info && ix.parsed.info.destination === SOL_WALLET) {
          isToUs = true;
          receivedLamports = ix.parsed.info.lamports || 0;
        }
      });

      if (!isToUs) {
        if (errorEl) { errorEl.textContent = 'Transa√ß√£o v√°lida, mas o destino n√£o √© a carteira dos Gatinhos do Rio.'; errorEl.style.display = 'block'; }
        if (verifyBtn) { verifyBtn.disabled = false; verifyBtn.textContent = 'üîç Verificar transa√ß√£o'; }
        return;
      }

      // Verifica se o valor est√° correto (com 5% de toler√¢ncia pra taxas)
      var total = getCartTotal();
      if (solPrice && solPrice > 0) {
        var expectedSol = total / solPrice;
        var expectedLamports = expectedSol * 1000000000;
        var receivedSol = receivedLamports / 1000000000;
        var tolerance = 0.05; // 5% de toler√¢ncia

        if (receivedLamports < expectedLamports * (1 - tolerance)) {
          if (errorEl) {
            errorEl.textContent = 'Valor insuficiente. Esperado: ~' + expectedSol.toFixed(4) + ' SOL, recebido: ' + receivedSol.toFixed(4) + ' SOL.';
            errorEl.style.display = 'block';
          }
          if (verifyBtn) { verifyBtn.disabled = false; verifyBtn.textContent = 'üîç Verificar transa√ß√£o'; }
          return;
        }
      }

      // TUDO CERTO! Transa√ß√£o confirmada e pro endere√ßo correto
      var txPrompt = document.getElementById('solTxPrompt');
      if (txPrompt) txPrompt.remove();

      document.getElementById('solScreen').style.display = 'none';
      document.getElementById('solConfirmingScreen').style.display = 'block';

      var solConfText = document.querySelector('#solConfirmingScreen .pix-confirming-text');
      if (solConfText) { solConfText.textContent = '‚úÖ Transa√ß√£o confirmada!'; solConfText.style.color = '#00FFA3'; }
      var solConfSub = document.querySelector('#solConfirmingScreen .pix-confirming-sub');
      if (solConfSub) solConfSub.textContent = 'TX: ' + txHash.slice(0, 16) + '...';

      sendDonationEmail();

      setTimeout(function() {
        document.getElementById('solModal').classList.remove('active');
        setTimeout(function() {
          document.getElementById('solScreen').style.display = 'block';
          document.getElementById('solConfirmingScreen').style.display = 'none';
        }, 400);
        donate();
      }, 2400);

    } catch (error) {
      console.error('Erro ao verificar TX:', error);
      if (errorEl) { errorEl.textContent = 'Erro ao verificar. Tente novamente.'; errorEl.style.display = 'block'; }
      if (verifyBtn) { verifyBtn.disabled = false; verifyBtn.textContent = 'üîç Verificar transa√ß√£o'; }
    }
  }

  function closeSolModal() {
    document.getElementById('solModal').classList.remove('active');
  }

  // ---- PIX (Mercado Pago API Real) ----
  let pixTimerInterval = null;
  let pixTimerSecs = 600;
  let pixPaymentId = null;
  let pixCheckInterval = null;

  function getCartTotal() {
    return Object.values(cart).reduce((sum, item) => sum + item.qty * item.price, 0);
  }

  function openPixModal() {
    hidePaymentSelector();
    const total = getCartTotal();
    
    var el;
    el = document.getElementById('pixAmountValue'); if (el) el.textContent = 'R$ ' + total.toFixed(2).replace('.',',');
    el = document.getElementById('pixAmountDest'); if (el) el.textContent = '‚Üí ' + selectedShelter;
    el = document.getElementById('pixEmailScreen'); if (el) el.style.display = 'block';
    el = document.getElementById('pixScreen'); if (el) el.style.display = 'none';
    el = document.getElementById('pixConfirmingScreen'); if (el) el.style.display = 'none';
    el = document.getElementById('pixErrorScreen'); if (el) el.style.display = 'none';
    el = document.getElementById('pixEmailError'); if (el) el.style.display = 'none';
    el = document.getElementById('pixGenerateBtn'); if (el) { el.disabled = false; el.textContent = 'üîÑ Gerar QR Code Pix'; }

    document.getElementById('pixModal').classList.add('active');
  }

  async function generateRealPix() {
    const emailInput = document.getElementById('pixEmailInput');
    const email = emailInput ? emailInput.value.trim() : '';
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

    if (!email || !emailRegex.test(email)) {
      const errEl = document.getElementById('pixEmailError');
      if (errEl) errEl.style.display = 'block';
      if (emailInput) emailInput.style.borderColor = '#e8621a';
      return;
    }
    const errEl2 = document.getElementById('pixEmailError');
    if (errEl2) errEl2.style.display = 'none';

    const btn = document.getElementById('pixGenerateBtn');
    if (btn) { btn.disabled = true; btn.textContent = '‚è≥ Gerando PIX...'; }

    const total = getCartTotal();
    const itemNames = Object.values(cart).map(i => i.name).join(', ');

    try {
      const response = await fetch('/api/pix', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          amount: total,
          description: 'Doacao Gatinhos do Rio - ' + (selectedShelter || 'Abrigo') + ' - ' + itemNames,
          shelter: selectedShelter,
          email: email
        })
      });

      let data;
      try {
        data = await response.json();
      } catch(jsonErr) {
        throw new Error('Servidor retornou resposta inv√°lida. Verifique se a API est√° configurada.');
      }

      if (!response.ok || !data.success) {
        throw new Error(data.error || 'Erro ao gerar PIX');
      }

      // Sucesso - mostrar QR Code
      pixPaymentId = data.payment_id;

      const av2 = document.getElementById('pixAmountValue2');
      if (av2) av2.textContent = 'R$ ' + total.toFixed(2).replace('.',',');
      const ad2 = document.getElementById('pixAmountDest2');
      if (ad2) ad2.textContent = '‚Üí ' + selectedShelter;

      // Mostrar QR Code real (base64)
      if (data.qr_code_base64) {
        const qrImg = document.getElementById('pixQrImage');
        if (qrImg) {
          qrImg.src = 'data:image/png;base64,' + data.qr_code_base64;
          qrImg.style.display = 'block';
        }
        const qrCanvas = document.getElementById('qrCanvas');
        if (qrCanvas) qrCanvas.style.display = 'none';
      }

      // C√≥digo copia e cola
      if (data.qr_code) {
        const pkv = document.getElementById('pixKeyVal');
        if (pkv) pkv.textContent = data.qr_code;
      }

      // Trocar tela
      const es = document.getElementById('pixEmailScreen');
      if (es) es.style.display = 'none';
      const ps = document.getElementById('pixScreen');
      if (ps) ps.style.display = 'block';

      // Iniciar timer
      pixTimerSecs = 600;
      updateTimerDisplay();
      clearInterval(pixTimerInterval);
      pixTimerInterval = setInterval(function() {
        pixTimerSecs--;
        updateTimerDisplay();
        if (pixTimerSecs <= 0) {
          clearInterval(pixTimerInterval);
          clearInterval(pixCheckInterval);
          var tn = document.getElementById('timerNum');
          if (tn) { tn.textContent = 'Expirado!'; tn.style.color = '#e8621a'; }
        }
      }, 1000);

      // Verificar automaticamente se pagou (a cada 5 segundos)
      var sm = document.getElementById('pixStatusMsg');
      if (sm) sm.style.display = 'block';
      clearInterval(pixCheckInterval);
      pixCheckInterval = setInterval(async function() {
        try {
          const statusRes = await fetch('/api/status?id=' + pixPaymentId);
          const statusData = await statusRes.json();
          if (statusData.paid) {
            clearInterval(pixCheckInterval);
            clearInterval(pixTimerInterval);
            pixPaymentApproved();
          }
        } catch(e) { /* silencioso */ }
      }, 5000);

    } catch (error) {
      console.error('Erro PIX:', error);
      var pes = document.getElementById('pixEmailScreen');
      if (pes) pes.style.display = 'none';
      var per = document.getElementById('pixErrorScreen');
      if (per) per.style.display = 'block';
      var pem = document.getElementById('pixErrorMsg');
      if (pem) pem.textContent = (error && error.message) ? error.message : 'Erro ao gerar PIX. Tente novamente.';
    }
  }

  function pixPaymentApproved() {
    document.getElementById('pixScreen').style.display = 'none';
    document.getElementById('pixConfirmingScreen').style.display = 'block';
    document.getElementById('pixConfirmingText').textContent = '‚úÖ Pagamento confirmado!';
    document.getElementById('pixConfirmingSub').textContent = 'Obrigado pela doa√ß√£o!';

    // Envia email personalizado
    sendDonationEmail();

    setTimeout(() => {
      document.getElementById('pixModal').classList.remove('active');
      setTimeout(() => {
        document.getElementById('pixConfirmingScreen').style.display = 'none';
      }, 400);
      donate();
    }, 2200);
  }

  function pixGoBackToEmail() {
    document.getElementById('pixErrorScreen').style.display = 'none';
    document.getElementById('pixEmailScreen').style.display = 'block';
    document.getElementById('pixGenerateBtn').disabled = false;
    document.getElementById('pixGenerateBtn').textContent = 'üîÑ Gerar QR Code Pix';
  }

  function updateTimerDisplay() {
    const m = Math.floor(pixTimerSecs / 60);
    const s = pixTimerSecs % 60;
    document.getElementById('timerNum').textContent = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
    const el = document.getElementById('timerNum');
    if (pixTimerSecs <= 60) el.style.color = '#e8621a';
    else el.style.color = '';
  }

  function copyPixKey() {
    const key = document.getElementById('pixKeyVal').textContent;
    navigator.clipboard.writeText(key).catch(() => {});
    const btn = document.getElementById('copyBtn');
    btn.textContent = '‚úÖ Copiado!';
    btn.classList.add('copied');
    setTimeout(() => {
      btn.textContent = 'üìã Copiar c√≥digo Pix';
      btn.classList.remove('copied');
    }, 2500);
  }

  async function confirmPix() {
    var confirmBtn = document.querySelector('#pixScreen .confirm-pix-btn');
    if (confirmBtn) { confirmBtn.disabled = true; confirmBtn.textContent = '‚è≥ Verificando pagamento...'; }

    clearInterval(pixTimerInterval);
    clearInterval(pixCheckInterval);

    // Verificar se o pagamento foi realmente aprovado
    if (pixPaymentId) {
      try {
        var statusRes = await fetch('/api/status?id=' + pixPaymentId);
        var statusData = await statusRes.json();

        if (statusData.paid) {
          // APROVADO - segue o fluxo normal
          document.getElementById('pixScreen').style.display = 'none';
          document.getElementById('pixConfirmingScreen').style.display = 'block';
          var ct = document.getElementById('pixConfirmingText');
          if (ct) ct.textContent = '‚úÖ Pagamento confirmado!';
          var cs = document.getElementById('pixConfirmingSub');
          if (cs) cs.textContent = 'Obrigado pela doa√ß√£o!';

          sendDonationEmail();

          setTimeout(function() {
            document.getElementById('pixModal').classList.remove('active');
            setTimeout(function() {
              var ps2 = document.getElementById('pixScreen');
              if (ps2) ps2.style.display = 'none';
              var pcs = document.getElementById('pixConfirmingScreen');
              if (pcs) pcs.style.display = 'none';
            }, 400);
            donate();
          }, 2200);
          return;
        }
      } catch(e) {
        console.log('Erro ao verificar:', e);
      }
    }

    // N√ÉO APROVADO - mostra mensagem de aviso
    if (confirmBtn) {
      confirmBtn.disabled = false;
      confirmBtn.textContent = '‚úÖ J√° paguei!';
    }

    // Mostra alerta de pagamento n√£o identificado
    var existingAlert = document.getElementById('pixNotPaidAlert');
    if (existingAlert) existingAlert.remove();

    var alert = document.createElement('div');
    alert.id = 'pixNotPaidAlert';
    alert.style.cssText = 'background:#fff3e0;border:2px solid #e8621a;border-radius:12px;padding:14px 18px;margin:12px 0;text-align:center;animation:slideUpFade 0.3s ease;';
    alert.innerHTML = '<div style="font-size:1.5rem;margin-bottom:6px;">‚è≥</div>' +
      '<div style="font-family:\'Fredoka One\',cursive;color:#e8621a;font-size:0.95rem;margin-bottom:4px;">Pagamento n√£o identificado ainda</div>' +
      '<div style="color:#888;font-size:0.8rem;">Se j√° pagou, aguarde alguns instantes e tente novamente. O PIX pode levar at√© 1 minuto para ser processado.</div>';

    var confirmBtnParent = confirmBtn ? confirmBtn.parentNode : document.getElementById('pixScreen');
    if (confirmBtnParent) confirmBtnParent.insertBefore(alert, confirmBtn);

    // Remove o alerta depois de 8 segundos
    setTimeout(function() {
      var a = document.getElementById('pixNotPaidAlert');
      if (a) a.remove();
    }, 8000);
  }

  function closePixModal() {
    document.getElementById('pixModal').classList.remove('active');
    clearInterval(pixTimerInterval);
    clearInterval(pixCheckInterval);
  }

  function shareInstagram() {
    // Build share text
    const rarityLabels = { comum: 'Comum', raro: 'Raro üîµ', epico: '√âpico üíú', lendario: 'LEND√ÅRIO üåü' };
    const rarity = rarityLabels[chosenPrize ? chosenPrize.rarity : 'comum'];
    const prize = chosenPrize ? chosenPrize.name : 'Brinde';
    const shelter = selectedShelter || 'um abrigo do Rio';
    const keys = Object.keys(cart);
    const totalVal = keys.reduce((s, k) => s + cart[k].qty * cart[k].price, 0);

    const text = `üê± Acabei de doe para os gatinhos do Rio!\n\n`
      + `üè† Abrigo: ${shelter}\n`
      + `üí∞ Doa√ß√£o: R$ ${totalVal.toFixed(2).replace('.',',')}\n`
      + `üéÅ Ganhei: ${prize} (${rarity})\n\n`
      + `Voc√™ tamb√©m pode ajudar! üëá\n`
      + `#GatinhosdoRio #DoeAmor #GatosCariocas #AdoteNaoCompre üêæ`;

    // Try Web Share API (works on mobile)
    if (navigator.share) {
      navigator.share({
        title: 'Doe para os Gatinhos do Rio! üê±',
        text: text,
        url: window.location.href
      }).catch(() => {});
    } else {
      // Fallback: open Instagram with pre-filled caption via clipboard
      navigator.clipboard.writeText(text).then(() => {
        const btn = document.querySelector('.share-ig');
        const orig = btn.innerHTML;
        btn.innerHTML = '‚úÖ Texto copiado! Abra o Instagram e cole na legenda';
        btn.style.fontSize = '0.75rem';
        setTimeout(() => {
          btn.innerHTML = orig;
          btn.style.fontSize = '';
          // Try to open Instagram
          window.open('https://www.instagram.com/', '_blank');
        }, 2000);
      }).catch(() => {
        window.open('https://www.instagram.com/', '_blank');
      });
    }
    meow('happy');
  }

  function copyShareText() {
    const rarityLabels = { comum: 'Comum', raro: 'Raro üîµ', epico: '√âpico üíú', lendario: 'LEND√ÅRIO üåü' };
    const rarity = rarityLabels[chosenPrize ? chosenPrize.rarity : 'comum'];
    const prize = chosenPrize ? chosenPrize.name : 'Brinde';
    const shelter = selectedShelter || 'um abrigo do Rio';
    const keys = Object.keys(cart);
    const totalVal = keys.reduce((s, k) => s + cart[k].qty * cart[k].price, 0);

    const text = `üê± Acabei de doe para os gatinhos do Rio!\n\n`
      + `üè† Abrigo: ${shelter}\n`
      + `üí∞ Doa√ß√£o: R$ ${totalVal.toFixed(2).replace('.',',')}\n`
      + `üéÅ Ganhei: ${prize} (${rarity})\n\n`
      + `Voc√™ tamb√©m pode ajudar! üëá\n`
      + `#GatinhosdoRio #DoeAmor #GatosCariocas #AdoteNaoCompre üêæ`;

    navigator.clipboard.writeText(text).then(() => {
      const btn = document.querySelector('.share-copy');
      btn.textContent = '‚úÖ Copiado!';
      btn.classList.add('copied');
      setTimeout(() => {
        btn.textContent = 'üìã Copiar texto';
        btn.classList.remove('copied');
      }, 2500);
    }).catch(() => {});
    meow('tiny');
  }

  // =============================================
  // üéÆ GAME ENGINE ‚Äî Gatinho Corredor de Copacabana
  // =============================================

  let gameRunning = false;
  let gameAnimFrame = null;
  let gameScore = 0;
  let gameCollected = 0;
  let gameLives = 3;
  let gameBest = 0;
  let gameSpeed = 4;
  let gameFrame = 0;
  let gameDiscount = 0;

  const CANVAS_W = 900;
  const CANVAS_H = 320;
  const GROUND_Y = 250;
  const GRAVITY = 0.55;
  const JUMP_FORCE = -13;

  // CAT player
  let cat = { x: 100, y: GROUND_Y, vy: 0, jumping: false, frame: 0, invincible: 0 };

  // Game objects
  let obstacles = [];
  let collectibles = [];
  let clouds = [];
  let birds = [];
  let waveOffset = 0;
  let bgOffset = 0;
  let palmOffset = 0;

  // Sprite colors
  const COLORS = {
    sky1: '#87CEEB', sky2: '#c8e8f8',
    sun: '#f5c518',
    sea: '#1e88e5', seaLight: '#42a5f5',
    wave: '#90caf9',
    sand: '#f5e6c8', sandDark: '#e8d4a0',
    palm: '#1a7a4a', palmTrunk: '#5c3d1e',
    cat: '#f4a460', catDark: '#c68642', catEye: '#2d2d2d',
    obstacle: '#e8621a',
    coin: '#f5c518',
  };

  const ITEMS = [
    { emoji: 'ü•£', label: 'Ra√ß√£o', points: 10, color: '#f4a460' },
    { emoji: 'üíä', label: 'Rem√©dio', points: 25, color: '#e84393' },
    { emoji: 'ü™£', label: 'Areia', points: 10, color: '#d4a76a' },
    { emoji: 'üéæ', label: 'Brinquedo', points: 15, color: '#ff9800' },
    { emoji: 'üõèÔ∏è', label: 'Caminha', points: 30, color: '#9c27b0' },
    { emoji: '‚≠ê', label: 'Estrela', points: 50, color: '#f5c518' },
  ];

  const OBSTACLES_TYPES = [
    { type: 'crab',   w: 36, h: 28, color: '#e53935' },
    { type: 'rock',   w: 40, h: 44, color: '#78909c' },
    { type: 'post',   w: 16, h: 60, color: '#ef9a9a' }, // beach post
    { type: 'trash',  w: 32, h: 36, color: '#8d6e63' },
  ];

  function switchTab(tab) {
    document.getElementById('tabShop').classList.toggle('active', tab === 'shop');
    document.getElementById('tabGame').classList.toggle('active', tab === 'game');
    document.getElementById('shopContent').style.display = tab === 'shop' ? 'block' : 'none';
    document.getElementById('gameSection').style.display = tab === 'game' ? 'block' : 'none';
    if (tab === 'game') initGameClouds();
    if (tab === 'shop' && gameRunning) pauseGame();
  }

  function initGameClouds() {
    clouds = [];
    for (let i = 0; i < 5; i++) {
      clouds.push({ x: Math.random() * CANVAS_W, y: 20 + Math.random() * 60, w: 60 + Math.random() * 80, speed: 0.3 + Math.random() * 0.3 });
    }
    birds = [];
    for (let i = 0; i < 3; i++) {
      birds.push({ x: Math.random() * CANVAS_W, y: 30 + Math.random() * 80, frame: Math.floor(Math.random()*4), speed: 0.8 + Math.random() * 0.5, flap: Math.random() * Math.PI * 2 });
    }
    if (!gameRunning) drawIdleFrame();
  }

  function drawIdleFrame() {
    const canvas = document.getElementById('gameCanvas');
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    drawBackground(ctx);
    drawCat(ctx, cat);
  }

  function startGame() {
    document.getElementById('gameOverlay').classList.add('hidden');
    document.getElementById('gameOverOverlay').classList.add('hidden');

    gameRunning = true;
    gameScore = 0; gameCollected = 0; gameLives = 3;
    gameSpeed = 4; gameFrame = 0;
    cat = { x: 100, y: GROUND_Y, vy: 0, jumping: false, frame: 0, invincible: 0 };
    obstacles = []; collectibles = [];
    waveOffset = 0; bgOffset = 0;

    updateHUD();
    if (gameAnimFrame) cancelAnimationFrame(gameAnimFrame);
    gameLoop();
  }

  function pauseGame() {
    gameRunning = false;
    if (gameAnimFrame) cancelAnimationFrame(gameAnimFrame);
  }

  function jump() {
    if (!gameRunning) return;
    if (!cat.jumping || cat.y >= GROUND_Y) {
      cat.vy = JUMP_FORCE;
      cat.jumping = true;
      meow('happy');
    }
  }

  function gameLoop() {
    if (!gameRunning) return;
    const canvas = document.getElementById('gameCanvas');
    if (!canvas) return;
    const ctx = canvas.getContext('2d');

    gameFrame++;
    gameScore += 1;
    gameSpeed = 4 + Math.floor(gameFrame / 300) * 0.5;

    // Scroll bg
    bgOffset = (bgOffset + gameSpeed * 0.3) % CANVAS_W;
    waveOffset = (waveOffset + 1.5) % (Math.PI * 2);
    palmOffset = (palmOffset + gameSpeed * 0.5) % (CANVAS_W + 200);

    // Move clouds & birds
    clouds.forEach(c => { c.x -= c.speed; if (c.x < -150) c.x = CANVAS_W + 50; });
    birds.forEach(b => {
      b.x -= b.speed; b.flap += 0.15;
      if (b.x < -40) { b.x = CANVAS_W + 40; b.y = 30 + Math.random() * 80; }
    });

    // Physics
    cat.vy += GRAVITY;
    cat.y += cat.vy;
    if (cat.y >= GROUND_Y) { cat.y = GROUND_Y; cat.vy = 0; cat.jumping = false; }
    cat.frame = (cat.frame + 0.2) % 4;
    if (cat.invincible > 0) cat.invincible--;

    // Spawn obstacles
    if (gameFrame % Math.max(60, 120 - Math.floor(gameFrame / 200) * 5) === 0) {
      const ot = OBSTACLES_TYPES[Math.floor(Math.random() * OBSTACLES_TYPES.length)];
      obstacles.push({ ...ot, x: CANVAS_W + 20, active: true });
    }

    // Spawn collectibles
    if (gameFrame % 80 === 0) {
      const item = ITEMS[Math.floor(Math.random() * ITEMS.length)];
      const floaty = Math.random() > 0.5;
      collectibles.push({
        ...item, x: CANVAS_W + 20,
        y: floaty ? GROUND_Y - 80 - Math.random() * 40 : GROUND_Y - 30,
        bob: Math.random() * Math.PI * 2, active: true,
        scale: 1, opacity: 1
      });
    }

    // Move & check obstacles
    obstacles = obstacles.filter(o => {
      o.x -= gameSpeed;
      if (o.x + o.w < 0) return false;
      // Collision
      if (cat.invincible === 0 && rectsOverlap(
        cat.x + 8, cat.y - 32, 36, 36,
        o.x + 4, GROUND_Y - o.h + 4, o.w - 8, o.h - 8
      )) {
        gameLives--;
        cat.invincible = 90;
        meow('long');
        if (gameLives <= 0) { endGame(); return false; }
      }
      return true;
    });

    // Move & check collectibles
    collectibles = collectibles.filter(c => {
      c.x -= gameSpeed;
      c.bob += 0.08;
      c.y += Math.sin(c.bob) * 0.4;
      if (c.x + 30 < 0) return false;
      if (c.active && rectsOverlap(cat.x + 6, cat.y - 36, 40, 40, c.x, c.y - 24, 28, 28)) {
        c.active = false;
        gameScore += c.points;
        gameCollected++;
        meow('tiny');
        showFloatingText(ctx, c.x, c.y - 20, '+' + c.points, c.color);
        return false;
      }
      return c.active;
    });

    // Draw everything
    drawBackground(ctx);
    collectibles.forEach(c => drawCollectible(ctx, c));
    obstacles.forEach(o => drawObstacle(ctx, o));
    drawCat(ctx, cat);
    drawHUDCanvas(ctx);

    updateHUD();
    gameAnimFrame = requestAnimationFrame(gameLoop);
  }

  function rectsOverlap(ax, ay, aw, ah, bx, by, bw, bh) {
    return ax < bx + bw && ax + aw > bx && ay < by + bh && ay + ah > by;
  }

  function endGame() {
    gameRunning = false;
    cancelAnimationFrame(gameAnimFrame);
    if (gameScore > gameBest) gameBest = gameScore;
    gameDiscount = Math.min(15, Math.floor(gameCollected / 3));
    updateHUD();

    document.getElementById('gameOverTitle').textContent = gameLives <= 0 ? 'üòø Fim de Jogo!' : 'üéâ Incr√≠vel!';
    document.getElementById('gameOverSub').innerHTML =
      `Coletou <strong>${gameCollected}</strong> doa√ß√µes ‚Ä¢ <strong>${gameScore}</strong> pontos` +
      (gameDiscount > 0 ? `<br>üéÅ <strong>${gameDiscount}% de desconto</strong> desbloqueado na loja!` : '');
    document.getElementById('gameOverOverlay').classList.remove('hidden');
    document.getElementById('scoreBoardDiscount').textContent = gameDiscount + '%';
  }

  function updateHUD() {
    document.getElementById('gameScoreDisplay').textContent = gameScore;
    document.getElementById('gameCollectedDisplay').textContent = gameCollected;
    document.getElementById('gameLivesDisplay').textContent = '‚ù§Ô∏è'.repeat(Math.max(0, gameLives));
    document.getElementById('scoreBoardScore').textContent = gameScore;
    document.getElementById('scoreBoardCollected').textContent = gameCollected;
    document.getElementById('scoreBoardBest').textContent = gameBest;
  }

  const floatingTexts = [];
  function showFloatingText(ctx, x, y, text, color) {
    floatingTexts.push({ x, y, text, color, life: 40, vy: -1.5 });
  }

  // ---- DRAWING FUNCTIONS ----

  function drawBackground(ctx) {
    const W = CANVAS_W, H = CANVAS_H;

    // Sky gradient
    const skyGrad = ctx.createLinearGradient(0, 0, 0, GROUND_Y);
    skyGrad.addColorStop(0, '#5bbcf0');
    skyGrad.addColorStop(1, '#a8d8ea');
    ctx.fillStyle = skyGrad;
    ctx.fillRect(0, 0, W, GROUND_Y);

    // Sun
    ctx.save();
    ctx.shadowColor = 'rgba(245,197,24,0.4)';
    ctx.shadowBlur = 30;
    ctx.fillStyle = '#ffe066';
    ctx.beginPath(); ctx.arc(W - 80, 55, 36, 0, Math.PI * 2); ctx.fill();
    ctx.shadowBlur = 0;
    // Sun rays
    ctx.strokeStyle = 'rgba(255,224,0,0.35)';
    ctx.lineWidth = 2;
    for (let i = 0; i < 8; i++) {
      const a = (i / 8) * Math.PI * 2 + gameFrame * 0.01;
      ctx.beginPath();
      ctx.moveTo(W - 80 + Math.cos(a) * 42, 55 + Math.sin(a) * 42);
      ctx.lineTo(W - 80 + Math.cos(a) * 58, 55 + Math.sin(a) * 58);
      ctx.stroke();
    }
    ctx.restore();

    // Clouds
    ctx.fillStyle = 'rgba(255,255,255,0.88)';
    clouds.forEach(c => {
      drawCloud(ctx, c.x, c.y, c.w);
    });

    // Birds
    birds.forEach(b => drawBird(ctx, b.x, b.y, b.flap));

    // Mountains / Sugarloaf silhouette far bg
    ctx.fillStyle = 'rgba(100,140,180,0.3)';
    ctx.beginPath();
    ctx.moveTo(0, GROUND_Y - 30);
    ctx.bezierCurveTo(60, GROUND_Y - 80, 100, GROUND_Y - 90, 140, GROUND_Y - 60);
    ctx.bezierCurveTo(180, GROUND_Y - 100, 220, GROUND_Y - 115, 260, GROUND_Y - 80);
    ctx.bezierCurveTo(300, GROUND_Y - 55, 340, GROUND_Y - 40, W, GROUND_Y - 30);
    ctx.lineTo(W, GROUND_Y); ctx.lineTo(0, GROUND_Y);
    ctx.fill();

    // Ocean
    const seaGrad = ctx.createLinearGradient(0, GROUND_Y - 50, 0, GROUND_Y);
    seaGrad.addColorStop(0, '#1976d2');
    seaGrad.addColorStop(1, '#42a5f5');
    ctx.fillStyle = seaGrad;
    ctx.fillRect(0, GROUND_Y - 55, W, 60);

    // Sand
    const sandGrad = ctx.createLinearGradient(0, GROUND_Y - 5, 0, H);
    sandGrad.addColorStop(0, '#f0d898');
    sandGrad.addColorStop(0.3, '#e8ca80');
    sandGrad.addColorStop(1, '#d4aa60');
    ctx.fillStyle = sandGrad;
    ctx.fillRect(0, GROUND_Y - 5, W, H - GROUND_Y + 5);

    // Sand texture dots
    ctx.fillStyle = 'rgba(180,140,60,0.25)';
    for (let i = 0; i < 40; i++) {
      const sx = ((i * 73 + bgOffset * 0.5) % W);
      const sy = GROUND_Y + 5 + (i % 5) * 10;
      ctx.beginPath(); ctx.arc(sx, sy, 1.5 + (i % 3), 0, Math.PI * 2); ctx.fill();
    }

    // Palms (scrolling)
    const palmPositions = [120, 350, 580, 810, 1040, 1270];
    palmPositions.forEach(px => {
      const realX = ((px - palmOffset) % (CANVAS_W + 200) + CANVAS_W + 200) % (CANVAS_W + 200) - 100;
      if (realX > -120 && realX < W + 80) drawPalm(ctx, realX, GROUND_Y - 5);
    });

    // Cal√ßad√£o stripe (iconic Rio wave pattern)
    ctx.strokeStyle = 'rgba(255,255,255,0.4)';
    ctx.lineWidth = 3;
    ctx.setLineDash([8, 6]);
    ctx.beginPath();
    ctx.moveTo(0, GROUND_Y + 18);
    ctx.lineTo(W, GROUND_Y + 18);
    ctx.stroke();
    ctx.setLineDash([]);

    // Ground line
    ctx.fillStyle = '#c8a84a';
    ctx.fillRect(0, GROUND_Y - 5, W, 3);

    // Draw floating texts
    for (let i = floatingTexts.length - 1; i >= 0; i--) {
      const ft = floatingTexts[i];
      ctx.fillStyle = ft.color;
      ctx.font = 'bold 18px Fredoka One, cursive';
      ctx.globalAlpha = ft.life / 40;
      ctx.fillText(ft.text, ft.x, ft.y);
      ctx.globalAlpha = 1;
      ft.y += ft.vy;
      ft.life--;
      if (ft.life <= 0) floatingTexts.splice(i, 1);
    }
  }

  function drawCloud(ctx, x, y, w) {
    ctx.save();
    ctx.fillStyle = 'rgba(255,255,255,0.9)';
    const h = w * 0.45;
    ctx.beginPath();
    ctx.ellipse(x + w*0.5, y + h*0.5, w*0.5, h*0.4, 0, 0, Math.PI*2);
    ctx.ellipse(x + w*0.3, y + h*0.55, w*0.28, h*0.35, 0, 0, Math.PI*2);
    ctx.ellipse(x + w*0.7, y + h*0.6, w*0.25, h*0.32, 0, 0, Math.PI*2);
    ctx.fill();
    ctx.restore();
  }

  function drawBird(ctx, x, y, flap) {
    ctx.save();
    ctx.strokeStyle = 'rgba(50,80,120,0.7)';
    ctx.lineWidth = 2;
    ctx.lineCap = 'round';
    const wing = Math.sin(flap) * 6;
    ctx.beginPath();
    ctx.moveTo(x - 12, y + wing); ctx.quadraticCurveTo(x, y - 4, x + 12, y + wing);
    ctx.stroke();
    ctx.restore();
  }

  function drawPalm(ctx, x, y) {
    ctx.save();
    // Trunk
    ctx.strokeStyle = '#5c3d1e';
    ctx.lineWidth = 6;
    ctx.lineCap = 'round';
    ctx.beginPath();
    ctx.moveTo(x, y);
    ctx.bezierCurveTo(x - 5, y - 30, x + 8, y - 60, x + 2, y - 90);
    ctx.stroke();
    // Leaves
    const leafColors = ['#1a7a4a','#2e9e5e','#156638'];
    const leaves = [[-50,-10],[30,-15],[-20,-30],[40,-25],[-35,-40],[15,-45]];
    leaves.forEach(([lx, ly], i) => {
      ctx.strokeStyle = leafColors[i % 3];
      ctx.lineWidth = 4;
      ctx.beginPath();
      ctx.moveTo(x + 2, y - 90);
      ctx.bezierCurveTo(x + lx * 0.5, y - 90 + ly * 0.3, x + lx * 0.8, y - 90 + ly * 0.7, x + lx, y - 90 + ly);
      ctx.stroke();
    });
    // Coconuts
    ctx.fillStyle = '#8B4513';
    ctx.beginPath(); ctx.arc(x - 4, y - 86, 5, 0, Math.PI * 2); ctx.fill();
    ctx.beginPath(); ctx.arc(x + 6, y - 89, 4, 0, Math.PI * 2); ctx.fill();
    ctx.restore();
  }

  function drawCat(ctx, c) {
    ctx.save();
    const blink = cat.invincible > 0 && Math.floor(gameFrame / 6) % 2 === 0;
    if (blink) { ctx.globalAlpha = 0.3; }

    const x = c.x, y = c.y;
    const legOff = Math.sin(c.frame * Math.PI) * 5;

    // Body
    ctx.fillStyle = '#f4a460';
    ctx.beginPath();
    ctx.ellipse(x + 24, y - 18, 22, 16, 0, 0, Math.PI * 2);
    ctx.fill();

    // Belly stripe
    ctx.fillStyle = '#fde8c8';
    ctx.beginPath();
    ctx.ellipse(x + 26, y - 16, 12, 9, 0, 0, Math.PI * 2);
    ctx.fill();

    // Legs
    ctx.fillStyle = '#e8a070';
    ctx.fillRect(x + 6, y - 8 + legOff, 10, 10);
    ctx.fillRect(x + 18, y - 8 - legOff, 10, 10);
    ctx.fillRect(x + 30, y - 8 + legOff * 0.7, 10, 10);

    // Head
    ctx.fillStyle = '#f4a460';
    ctx.beginPath();
    ctx.ellipse(x + 40, y - 26, 16, 14, 0.1, 0, Math.PI * 2);
    ctx.fill();

    // Ears
    ctx.fillStyle = '#e8915a';
    ctx.beginPath();
    ctx.moveTo(x + 30, y - 36); ctx.lineTo(x + 26, y - 46); ctx.lineTo(x + 36, y - 38); ctx.fill();
    ctx.beginPath();
    ctx.moveTo(x + 44, y - 37); ctx.lineTo(x + 50, y - 47); ctx.lineTo(x + 54, y - 36); ctx.fill();

    // Inner ears
    ctx.fillStyle = '#f08080';
    ctx.beginPath();
    ctx.moveTo(x + 30.5, y - 37); ctx.lineTo(x + 27.5, y - 44); ctx.lineTo(x + 34.5, y - 38.5); ctx.fill();
    ctx.beginPath();
    ctx.moveTo(x + 45, y - 37.5); ctx.lineTo(x + 49.5, y - 45); ctx.lineTo(x + 52.5, y - 37); ctx.fill();

    // Eyes
    ctx.fillStyle = '#2d2d2d';
    if (cat.invincible === 0 || Math.floor(gameFrame / 30) % 3 !== 0) {
      ctx.beginPath(); ctx.arc(x + 37, y - 28, 3.5, 0, Math.PI * 2); ctx.fill();
      ctx.beginPath(); ctx.arc(x + 46, y - 28, 3.5, 0, Math.PI * 2); ctx.fill();
      ctx.fillStyle = '#f0f0f0';
      ctx.beginPath(); ctx.arc(x + 38, y - 29, 1.2, 0, Math.PI * 2); ctx.fill();
      ctx.beginPath(); ctx.arc(x + 47, y - 29, 1.2, 0, Math.PI * 2); ctx.fill();
    } else {
      // Blink
      ctx.strokeStyle = '#2d2d2d'; ctx.lineWidth = 2;
      ctx.beginPath(); ctx.moveTo(x + 33.5, y - 28); ctx.lineTo(x + 40.5, y - 28); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(x + 42.5, y - 28); ctx.lineTo(x + 49.5, y - 28); ctx.stroke();
    }

    // Nose
    ctx.fillStyle = '#e05c7a';
    ctx.beginPath(); ctx.arc(x + 41.5, y - 23, 2.5, 0, Math.PI * 2); ctx.fill();

    // Whiskers
    ctx.strokeStyle = 'rgba(100,60,20,0.5)'; ctx.lineWidth = 1;
    [[x + 28, y - 23, x + 18, y - 21], [x + 28, y - 22, x + 18, y - 24],
     [x + 55, y - 23, x + 65, y - 21], [x + 55, y - 22, x + 65, y - 24]].forEach(([x1,y1,x2,y2]) => {
      ctx.beginPath(); ctx.moveTo(x1, y1); ctx.lineTo(x2, y2); ctx.stroke();
    });

    // Tail
    ctx.strokeStyle = '#c68642'; ctx.lineWidth = 5; ctx.lineCap = 'round';
    ctx.beginPath();
    const tailWag = Math.sin(gameFrame * 0.15) * 12;
    ctx.moveTo(x + 4, y - 12);
    ctx.bezierCurveTo(x - 8, y - 20, x - 12, y - 40 + tailWag, x - 2, y - 50 + tailWag);
    ctx.stroke();

    ctx.globalAlpha = 1;
    ctx.restore();
  }

  function drawObstacle(ctx, o) {
    ctx.save();
    const x = o.x, base = GROUND_Y;
    if (o.type === 'crab') {
      // Crab body
      ctx.fillStyle = '#e53935';
      ctx.beginPath(); ctx.ellipse(x + 18, base - 14, 16, 10, 0, 0, Math.PI * 2); ctx.fill();
      // Claws
      ctx.fillStyle = '#c62828';
      ctx.fillRect(x, base - 20, 8, 10);
      ctx.fillRect(x + 28, base - 20, 8, 10);
      // Eyes
      ctx.fillStyle = '#111';
      ctx.beginPath(); ctx.arc(x + 12, base - 18, 3, 0, Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.arc(x + 24, base - 18, 3, 0, Math.PI*2); ctx.fill();
      // Legs
      ctx.strokeStyle = '#c62828'; ctx.lineWidth = 2;
      for (let i = 0; i < 3; i++) {
        const lx = x + 8 + i * 8;
        const legAnim = Math.sin(gameFrame * 0.2 + i) * 4;
        ctx.beginPath(); ctx.moveTo(lx, base - 10); ctx.lineTo(lx - 4, base + legAnim); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(lx + 2, base - 10); ctx.lineTo(lx + 8, base + legAnim); ctx.stroke();
      }
    } else if (o.type === 'rock') {
      ctx.fillStyle = '#78909c';
      ctx.beginPath();
      ctx.moveTo(x + 5, base); ctx.lineTo(x, base - 20);
      ctx.lineTo(x + 8, base - 40); ctx.lineTo(x + 20, base - 44);
      ctx.lineTo(x + 35, base - 36); ctx.lineTo(x + 40, base - 16);
      ctx.lineTo(x + 36, base); ctx.closePath(); ctx.fill();
      ctx.fillStyle = '#90a4ae';
      ctx.beginPath(); ctx.ellipse(x + 20, base - 28, 8, 5, -0.3, 0, Math.PI * 2); ctx.fill();
    } else if (o.type === 'post') {
      // Beach lifeguard post
      ctx.fillStyle = '#ef9a9a';
      ctx.fillRect(x + 4, base - o.h, 8, o.h);
      ctx.fillStyle = '#e53935';
      ctx.fillRect(x, base - o.h, 16, 10);
      ctx.fillStyle = '#ef9a9a';
      ctx.fillRect(x - 4, base - o.h * 0.6, 24, 6);
      // Flag
      ctx.fillStyle = '#f5c518';
      ctx.beginPath();
      ctx.moveTo(x + 4, base - o.h);
      ctx.lineTo(x + 20, base - o.h + 8);
      ctx.lineTo(x + 4, base - o.h + 16);
      ctx.fill();
    } else if (o.type === 'trash') {
      ctx.fillStyle = '#8d6e63';
      ctx.fillRect(x + 4, base - o.h + 6, o.w - 8, o.h - 6);
      ctx.fillStyle = '#6d4c41';
      ctx.fillRect(x, base - o.h + 3, o.w, 6);
      ctx.fillStyle = '#a1887f';
      ctx.fillRect(x + 10, base - o.h + 6, 4, o.h - 6);
      ctx.fillRect(x + 18, base - o.h + 6, 4, o.h - 6);
    }
    ctx.restore();
  }

  function drawCollectible(ctx, c) {
    ctx.save();
    ctx.font = '26px Arial';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    // Glow
    ctx.shadowColor = c.color;
    ctx.shadowBlur = 12;
    ctx.fillText(c.emoji, c.x + 14, c.y - 12);
    ctx.shadowBlur = 0;
    ctx.restore();
  }

  function drawHUDCanvas(ctx) {
    // Score in canvas
    ctx.save();
    ctx.font = 'bold 16px Fredoka One, cursive';
    ctx.fillStyle = 'rgba(0,0,0,0.4)';
    ctx.fillRect(8, 8, 120, 28);
    ctx.fillStyle = '#fff';
    ctx.fillText('üéØ ' + gameScore, 14, 27);
    ctx.restore();
  }

  // Input
  document.addEventListener('keydown', e => {
    if (e.code === 'Space' || e.code === 'ArrowUp') {
      e.preventDefault();
      jump();
    }
  });

  document.getElementById('gameCanvasWrap')?.addEventListener('click', () => {
    if (gameRunning) jump();
  });
  document.getElementById('gameCanvasWrap')?.addEventListener('touchstart', e => {
    e.preventDefault();
    if (gameRunning) jump();
  }, { passive: false });

  // =============================================
  // END GAME ENGINE
  // =============================================

  function scrollToCart() {
    document.getElementById('cartSection').scrollIntoView({ behavior: 'smooth' });
  }

</script>

</body>
</html>
